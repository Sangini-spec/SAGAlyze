{"file_contents":{"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"light\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"light\",\n  storageKey = \"sagalyze-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","size_bytes":1364},"client/src/components/patient-card.tsx":{"content":"import { Link } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { User } from \"lucide-react\";\nimport type { Patient } from \"@shared/schema\";\nimport { format } from \"date-fns\";\n\ninterface PatientCardProps {\n  patient: Patient;\n}\n\nexport function PatientCard({ patient }: PatientCardProps) {\n  const initials = patient.name\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n\n  return (\n    <Link href={`/patients/${patient.id}`}>\n      <Card\n        className=\"p-6 hover-elevate active-elevate-2 cursor-pointer transition-shadow\"\n        data-testid={`card-patient-${patient.id}`}\n      >\n        <div className=\"flex items-start gap-4\">\n          <Avatar className=\"h-12 w-12\">\n            <AvatarFallback className=\"bg-primary text-primary-foreground\">\n              {initials}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-medium text-card-foreground truncate\" data-testid={`text-patient-name-${patient.id}`}>\n              {patient.name}\n            </h3>\n            <p className=\"text-sm text-muted-foreground font-mono mt-1\" data-testid={`text-patient-id-${patient.id}`}>\n              ID: {patient.patientId}\n            </p>\n            <div className=\"flex items-center gap-2 mt-3 flex-wrap\">\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {patient.gender}\n              </Badge>\n              {patient.fitzpatrickType && (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  Type {patient.fitzpatrickType}\n                </Badge>\n              )}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-3\">\n              Added {format(new Date(patient.createdAt), \"MMM d, yyyy\")}\n            </p>\n          </div>\n        </div>\n      </Card>\n    </Link>\n  );\n}\n","size_bytes":2002},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/pages/new-patient.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { insertPatientSchema, type InsertPatient, type Patient } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft, Copy, Check, AlertCircle, Shield } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function NewPatient() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [showTokenDialog, setShowTokenDialog] = useState(false);\n  const [plaintextToken, setPlaintextToken] = useState<string>(\"\");\n  const [copied, setCopied] = useState(false);\n\n  const form = useForm<InsertPatient>({\n    resolver: zodResolver(insertPatientSchema),\n    defaultValues: {\n      patientId: \"\",\n      name: \"\",\n      dateOfBirth: \"\",\n      gender: \"\",\n      fitzpatrickType: undefined,\n      contactEmail: undefined,\n      contactPhone: undefined,\n    },\n  });\n\n  const createPatient = useMutation({\n    mutationFn: async (data: InsertPatient) => {\n      const response = await apiRequest(\"POST\", \"/api/patients\", data);\n      return (await response.json()) as Patient & { plaintextToken: string };\n    },\n    onSuccess: (data: Patient & { plaintextToken: string }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/patients\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      \n      // Show token dialog with the one-time plaintext token\n      setPlaintextToken(data.plaintextToken);\n      setShowTokenDialog(true);\n      \n      toast({\n        title: \"Patient created\",\n        description: \"Patient record has been successfully created.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertPatient) => {\n    createPatient.mutate(data);\n  };\n\n  const handleCopyToken = async () => {\n    try {\n      await navigator.clipboard.writeText(plaintextToken);\n      setCopied(true);\n      toast({\n        title: \"Token copied\",\n        description: \"Access token has been copied to clipboard.\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      toast({\n        title: \"Failed to copy\",\n        description: \"Please copy the token manually.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCloseTokenDialog = () => {\n    setShowTokenDialog(false);\n    setPlaintextToken(\"\");\n    setCopied(false);\n    setLocation(\"/\");\n  };\n\n  return (\n    <>\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-3xl font-medium text-foreground\">Add New Patient</h1>\n            <p className=\"text-muted-foreground mt-1\">\n              Create a new patient record\n            </p>\n          </div>\n        </div>\n\n        <Card className=\"p-6\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"patientId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Patient ID</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"e.g., P-2025-001\"\n                        {...field}\n                        data-testid=\"input-patient-id\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Full Name</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Enter patient name\"\n                        {...field}\n                        data-testid=\"input-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <FormField\n                  control={form.control}\n                  name=\"dateOfBirth\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Date of Birth</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"date\"\n                          {...field}\n                          data-testid=\"input-dob\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"gender\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Gender</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        defaultValue={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-gender\">\n                            <SelectValue placeholder=\"Select gender\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Male\">Male</SelectItem>\n                          <SelectItem value=\"Female\">Female</SelectItem>\n                          <SelectItem value=\"Other\">Other</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"fitzpatrickType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Fitzpatrick Skin Type (Optional)</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      defaultValue={field.value ?? undefined}\n                    >\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-fitzpatrick\">\n                          <SelectValue placeholder=\"Select skin type\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"I\">Type I - Always burns, never tans</SelectItem>\n                        <SelectItem value=\"II\">Type II - Usually burns, tans minimally</SelectItem>\n                        <SelectItem value=\"III\">Type III - Sometimes burns, tans uniformly</SelectItem>\n                        <SelectItem value=\"IV\">Type IV - Burns minimally, always tans</SelectItem>\n                        <SelectItem value=\"V\">Type V - Rarely burns, tans profusely</SelectItem>\n                        <SelectItem value=\"VI\">Type VI - Never burns, deeply pigmented</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <FormField\n                  control={form.control}\n                  name=\"contactEmail\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"patient@example.com\"\n                          {...field}\n                          value={field.value ?? \"\"}\n                          data-testid=\"input-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"contactPhone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"tel\"\n                          placeholder=\"+1 (555) 000-0000\"\n                          {...field}\n                          value={field.value ?? \"\"}\n                          data-testid=\"input-phone\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"flex gap-4 pt-4\">\n                <Link href=\"/\" className=\"flex-1\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"w-full\"\n                    data-testid=\"button-cancel\"\n                  >\n                    Cancel\n                  </Button>\n                </Link>\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={createPatient.isPending}\n                  data-testid=\"button-submit\"\n                >\n                  {createPatient.isPending ? \"Creating...\" : \"Create Patient\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </Card>\n      </div>\n\n      {/* Token Reveal Dialog - One-time viewing */}\n      <Dialog open={showTokenDialog} onOpenChange={() => {}}>\n        <DialogContent className=\"max-w-lg\" onPointerDownOutside={(e) => e.preventDefault()}>\n          <DialogHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                <Shield className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <DialogTitle className=\"text-xl\">Patient Access Token Generated</DialogTitle>\n                <DialogDescription className=\"mt-1\">\n                  Share this token with the patient for portal access\n                </DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n\n          <div className=\"space-y-4 py-4\">\n            <div className=\"p-4 rounded-md bg-muted border-2 border-border\">\n              <p className=\"text-sm text-muted-foreground mb-2 font-medium\">Access Token</p>\n              <div className=\"flex items-center gap-2\">\n                <code className=\"flex-1 text-sm font-mono bg-background px-3 py-2 rounded border border-border break-all\" data-testid=\"text-token\">\n                  {plaintextToken}\n                </code>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={handleCopyToken}\n                  data-testid=\"button-copy-token\"\n                >\n                  {copied ? (\n                    <Check className=\"h-4 w-4 text-primary\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 p-4 rounded-md bg-destructive/10 border border-destructive/30\">\n              <AlertCircle className=\"h-5 w-5 text-destructive flex-shrink-0 mt-0.5\" />\n              <div className=\"space-y-2\">\n                <p className=\"text-sm font-medium text-destructive\">Important Security Notice</p>\n                <ul className=\"text-xs text-destructive/90 space-y-1 list-disc list-inside\">\n                  <li>This token will only be shown once - copy it now</li>\n                  <li>Share this token securely with the patient</li>\n                  <li>Patient will need this token along with their ID, name, and date of birth to access the portal</li>\n                  <li>If lost, you can regenerate a new token from the patient details page</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button\n              onClick={handleCloseTokenDialog}\n              className=\"w-full\"\n              data-testid=\"button-confirm\"\n            >\n              I've Saved the Token\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":13620},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2210},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/lesion-comparison.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { format } from \"date-fns\";\nimport { TrendingUp, TrendingDown, Minus, ArrowRight } from \"lucide-react\";\nimport type { Lesion, Analysis } from \"@shared/schema\";\nimport { motion } from \"framer-motion\";\n\ninterface LesionComparisonProps {\n  lesion1: Lesion & { analysis?: Analysis };\n  lesion2: Lesion & { analysis?: Analysis };\n}\n\n// Calculate improvement percentage based on classification and confidence\nfunction calculateImprovement(\n  analysis1?: Analysis,\n  analysis2?: Analysis\n): {\n  score: number; // Can be negative (worsened) or positive (improved)\n  trend: \"improved\" | \"worsened\" | \"no-change\";\n  message: string;\n} {\n  if (!analysis1 || !analysis2) {\n    return {\n      score: 0,\n      trend: \"no-change\",\n      message: \"Insufficient data for comparison\",\n    };\n  }\n\n  // Classification severity mapping (lower is better)\n  const severityMap: Record<string, number> = {\n    Benign: 1,\n    Rash: 2,\n    Infection: 3,\n    Malignant: 4,\n  };\n\n  const severity1 = severityMap[analysis1.classification];\n  const severity2 = severityMap[analysis2.classification];\n\n  // Handle unknown classifications by using confidence delta only\n  if (severity1 === undefined || severity2 === undefined) {\n    const confidenceDelta = analysis2.confidence - analysis1.confidence;\n    const normalizedScore = confidenceDelta * 0.3; // Smaller weight for confidence-only\n    \n    return {\n      score: normalizedScore,\n      trend: normalizedScore > 5 ? \"improved\" : normalizedScore < -5 ? \"worsened\" : \"no-change\",\n      message: normalizedScore > 5\n        ? \"Confidence levels have improved\"\n        : normalizedScore < -5\n        ? \"Confidence levels have decreased\"\n        : \"Condition appears stable\",\n    };\n  }\n\n  // Calculate improvement based on severity change and confidence\n  let improvementScore = 0;\n\n  // If classification improved (lower severity) - POSITIVE score\n  if (severity2 < severity1) {\n    const severityImprovement = ((severity1 - severity2) / severity1) * 100;\n    const confidenceBoost = (analysis2.confidence / 100) * 20; // Max 20% boost\n    improvementScore = Math.min(100, severityImprovement + confidenceBoost);\n  }\n  // If classification worsened (higher severity) - NEGATIVE score\n  else if (severity2 > severity1) {\n    const severityDegradation = ((severity2 - severity1) / severity1) * 100;\n    const confidenceBoost = (analysis2.confidence / 100) * 20;\n    improvementScore = -Math.min(100, severityDegradation + confidenceBoost); // Keep negative!\n  }\n  // Same classification - check confidence change\n  else {\n    const confidenceDelta = analysis2.confidence - analysis1.confidence;\n    improvementScore = confidenceDelta * 0.5; // Smaller weight for same classification\n  }\n\n  const trend =\n    improvementScore > 5\n      ? \"improved\"\n      : improvementScore < -5\n      ? \"worsened\"\n      : \"no-change\";\n\n  const message =\n    trend === \"improved\"\n      ? \"Lesion showing signs of improvement\"\n      : trend === \"worsened\"\n      ? \"Lesion requires attention - condition has worsened\"\n      : \"Lesion condition stable - no significant change\";\n\n  return {\n    score: improvementScore,\n    trend,\n    message,\n  };\n}\n\nexport function LesionComparison({ lesion1, lesion2 }: LesionComparisonProps) {\n  const [sliderPosition, setSliderPosition] = useState(50);\n  const [isDragging, setIsDragging] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const improvement = calculateImprovement(lesion1.analysis, lesion2.analysis);\n\n  const handleMove = (clientX: number) => {\n    if (!containerRef.current) return;\n\n    const rect = containerRef.current.getBoundingClientRect();\n    const x = clientX - rect.left;\n    const percentage = (x / rect.width) * 100;\n    setSliderPosition(Math.max(0, Math.min(100, percentage)));\n  };\n\n  const handleMouseMove = (e: MouseEvent) => {\n    if (isDragging) {\n      e.preventDefault();\n      handleMove(e.clientX);\n    }\n  };\n\n  const handleTouchMove = (e: TouchEvent) => {\n    if (isDragging && e.touches[0]) {\n      e.preventDefault();\n      handleMove(e.touches[0].clientX);\n    }\n  };\n\n  const handleStart = (e: React.MouseEvent | React.TouchEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n  \n  const handleEnd = () => setIsDragging(false);\n\n  useEffect(() => {\n    if (isDragging) {\n      document.addEventListener(\"mousemove\", handleMouseMove, { passive: false });\n      document.addEventListener(\"mouseup\", handleEnd);\n      document.addEventListener(\"touchmove\", handleTouchMove, { passive: false });\n      document.addEventListener(\"touchend\", handleEnd);\n    }\n\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleEnd);\n      document.removeEventListener(\"touchmove\", handleTouchMove);\n      document.removeEventListener(\"touchend\", handleEnd);\n    };\n  }, [isDragging]);\n\n  const trendColor =\n    improvement.trend === \"improved\"\n      ? \"text-success\"\n      : improvement.trend === \"worsened\"\n      ? \"text-destructive\"\n      : \"text-muted-foreground\";\n\n  const trendBgColor =\n    improvement.trend === \"improved\"\n      ? \"bg-success/10\"\n      : improvement.trend === \"worsened\"\n      ? \"bg-destructive/10\"\n      : \"bg-muted\";\n\n  const TrendIcon =\n    improvement.trend === \"improved\"\n      ? TrendingUp\n      : improvement.trend === \"worsened\"\n      ? TrendingDown\n      : Minus;\n\n  // For display: show absolute value but keep context clear\n  const displayPercentage = Math.abs(Math.round(improvement.score));\n  const scoreLabel = improvement.trend === \"improved\"\n    ? \"Improvement Level\"\n    : improvement.trend === \"worsened\"\n    ? \"Deterioration Level\"\n    : \"Stability Level\";\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Trend Summary Card */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3 }}\n      >\n        <Card className=\"p-6 shadow-md\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className={`h-12 w-12 rounded-full ${trendBgColor} flex items-center justify-center`}>\n                <TrendIcon className={`h-6 w-6 ${trendColor}`} />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-medium text-card-foreground\">\n                  Progress Analysis\n                </h3>\n                <p className=\"text-sm text-muted-foreground\">{improvement.message}</p>\n              </div>\n            </div>\n            <Badge\n              variant={\n                improvement.trend === \"improved\"\n                  ? \"default\"\n                  : improvement.trend === \"worsened\"\n                  ? \"destructive\"\n                  : \"secondary\"\n              }\n              className=\"text-base px-4 py-2\"\n              data-testid=\"badge-trend\"\n            >\n              {improvement.trend === \"improved\" && \"Improved\"}\n              {improvement.trend === \"worsened\" && \"Worsened\"}\n              {improvement.trend === \"no-change\" && \"No Change\"}\n            </Badge>\n          </div>\n\n          {/* Improvement Progress Bar */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-muted-foreground\">{scoreLabel}</span>\n              <span className={`font-mono font-medium ${trendColor}`} data-testid=\"text-improvement-percentage\">\n                {improvement.score > 0 && \"+\"}{Math.round(improvement.score)}%\n              </span>\n            </div>\n            <div className=\"relative\">\n              <Progress\n                value={displayPercentage}\n                className={`h-3 ${\n                  improvement.trend === \"worsened\" \n                    ? \"[&>div]:bg-destructive\" \n                    : improvement.trend === \"improved\"\n                    ? \"[&>div]:bg-success\"\n                    : \"\"\n                }`}\n                data-testid=\"progress-improvement\"\n              />\n            </div>\n          </div>\n\n          {/* Comparison Timeline */}\n          <div className=\"flex items-center gap-4 mt-6 pt-4 border-t border-border\">\n            <div className=\"flex-1\">\n              <p className=\"text-xs text-muted-foreground\">Earlier Scan</p>\n              <p className=\"text-sm font-medium\">\n                {format(new Date(lesion1.capturedAt), \"MMM d, yyyy\")}\n              </p>\n            </div>\n            <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n            <div className=\"flex-1 text-right\">\n              <p className=\"text-xs text-muted-foreground\">Recent Scan</p>\n              <p className=\"text-sm font-medium\">\n                {format(new Date(lesion2.capturedAt), \"MMM d, yyyy\")}\n              </p>\n            </div>\n          </div>\n        </Card>\n      </motion.div>\n\n      {/* Interactive Image Comparison Slider */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.1 }}\n      >\n        <Card className=\"p-6 shadow-md\">\n          <h3 className=\"text-lg font-medium text-card-foreground mb-4\">\n            Image Comparison\n          </h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Drag the slider to compare before and after images\n          </p>\n\n          <div\n            ref={containerRef}\n            className=\"relative aspect-square rounded-lg overflow-hidden bg-muted border-2 border-border select-none\"\n            style={{ touchAction: 'none' }}\n            data-testid=\"image-comparison-container\"\n          >\n            {/* After Image (Full) */}\n            <div className=\"absolute inset-0\">\n              <img\n                src={lesion2.imagePath}\n                alt=\"After\"\n                className=\"w-full h-full object-cover\"\n                data-testid=\"img-after\"\n                draggable={false}\n              />\n              <div className=\"absolute top-4 right-4 bg-background/90 backdrop-blur-sm px-3 py-1.5 rounded-md border border-border\">\n                <span className=\"text-xs font-medium\">After</span>\n              </div>\n            </div>\n\n            {/* Before Image (Clipped) */}\n            <div\n              className=\"absolute inset-0 overflow-hidden pointer-events-none\"\n              style={{ clipPath: `inset(0 ${100 - sliderPosition}% 0 0)` }}\n            >\n              <img\n                src={lesion1.imagePath}\n                alt=\"Before\"\n                className=\"w-full h-full object-cover\"\n                data-testid=\"img-before\"\n                draggable={false}\n              />\n              <div className=\"absolute top-4 left-4 bg-background/90 backdrop-blur-sm px-3 py-1.5 rounded-md border border-border\">\n                <span className=\"text-xs font-medium\">Before</span>\n              </div>\n            </div>\n\n            {/* Slider Handle */}\n            <div\n              className=\"absolute top-0 bottom-0 w-1 bg-primary cursor-ew-resize z-10\"\n              style={{ left: `${sliderPosition}%` }}\n              onMouseDown={handleStart}\n              onTouchStart={handleStart}\n              role=\"slider\"\n              aria-label=\"Image comparison slider\"\n              aria-valuemin={0}\n              aria-valuemax={100}\n              aria-valuenow={Math.round(sliderPosition)}\n              tabIndex={0}\n              data-testid=\"slider-handle\"\n            >\n              <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-primary rounded-full border-4 border-background shadow-lg flex items-center justify-center hover:scale-110 transition-transform cursor-ew-resize\">\n                <div className=\"flex gap-1\">\n                  <div className=\"w-0.5 h-4 bg-primary-foreground rounded-full\" />\n                  <div className=\"w-0.5 h-4 bg-primary-foreground rounded-full\" />\n                </div>\n              </div>\n            </div>\n          </div>\n        </Card>\n      </motion.div>\n\n      {/* Analysis Details Grid */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.2 }}\n        className=\"grid grid-cols-1 md:grid-cols-2 gap-6\"\n      >\n        {/* Before Analysis */}\n        <Card className=\"p-6 shadow-md\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-card-foreground\">Before Analysis</h3>\n            <Badge variant=\"outline\">\n              {format(new Date(lesion1.capturedAt), \"MMM d, yyyy\")}\n            </Badge>\n          </div>\n          {lesion1.analysis ? (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Classification</span>\n                <Badge variant=\"secondary\" data-testid=\"text-before-classification\">\n                  {lesion1.analysis.classification}\n                </Badge>\n              </div>\n              <div className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Confidence</span>\n                <span className=\"text-sm font-mono font-medium\" data-testid=\"text-before-confidence\">\n                  {lesion1.analysis.confidence}%\n                </span>\n              </div>\n              <div className=\"pt-3 border-t border-border\">\n                <p className=\"text-sm text-muted-foreground\">\n                  <span className=\"font-medium\">Location:</span> {lesion1.location}\n                </p>\n                {lesion1.notes && (\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    <span className=\"font-medium\">Notes:</span> {lesion1.notes}\n                  </p>\n                )}\n              </div>\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground\">No analysis available</p>\n          )}\n        </Card>\n\n        {/* After Analysis */}\n        <Card className=\"p-6 shadow-md\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-card-foreground\">After Analysis</h3>\n            <Badge variant=\"outline\">\n              {format(new Date(lesion2.capturedAt), \"MMM d, yyyy\")}\n            </Badge>\n          </div>\n          {lesion2.analysis ? (\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Classification</span>\n                <Badge variant=\"secondary\" data-testid=\"text-after-classification\">\n                  {lesion2.analysis.classification}\n                </Badge>\n              </div>\n              <div className=\"flex items-center justify-between p-3 bg-muted rounded-md\">\n                <span className=\"text-sm text-muted-foreground\">Confidence</span>\n                <span className=\"text-sm font-mono font-medium\" data-testid=\"text-after-confidence\">\n                  {lesion2.analysis.confidence}%\n                </span>\n              </div>\n              <div className=\"pt-3 border-t border-border\">\n                <p className=\"text-sm text-muted-foreground\">\n                  <span className=\"font-medium\">Location:</span> {lesion2.location}\n                </p>\n                {lesion2.notes && (\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    <span className=\"font-medium\">Notes:</span> {lesion2.notes}\n                  </p>\n                )}\n              </div>\n            </div>\n          ) : (\n            <p className=\"text-sm text-muted-foreground\">No analysis available</p>\n          )}\n        </Card>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":16134},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/pages/patient-detail.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useRoute, Link } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { ArrowLeft, Calendar, Mail, Phone, User, Activity, Shield, Copy, Check, AlertCircle, RefreshCw } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { Patient, Lesion, Analysis } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function PatientDetail() {\n  const [, params] = useRoute(\"/patients/:id\");\n  const patientId = params?.id;\n  const { toast } = useToast();\n\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [showTokenDialog, setShowTokenDialog] = useState(false);\n  const [plaintextToken, setPlaintextToken] = useState<string>(\"\");\n  const [copied, setCopied] = useState(false);\n\n  const { data: patient, isLoading: loadingPatient } = useQuery<Patient>({\n    queryKey: [\"/api/patients\", patientId],\n    enabled: !!patientId,\n  });\n\n  const { data: lesions, isLoading: loadingLesions } = useQuery<\n    (Lesion & { analysis?: Analysis })[]\n  >({\n    queryKey: [\"/api/patients\", patientId, \"lesions\"],\n    enabled: !!patientId,\n  });\n\n  const regenerateToken = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/patients/${patientId}/regenerate-token`, {});\n      return (await response.json()) as Patient & { plaintextToken: string };\n    },\n    onSuccess: (data: Patient & { plaintextToken: string }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/patients\", patientId] });\n      setPlaintextToken(data.plaintextToken);\n      setShowConfirmDialog(false);\n      setShowTokenDialog(true);\n      toast({\n        title: \"Token regenerated\",\n        description: \"A new access token has been generated for this patient.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleRegenerateClick = () => {\n    setShowConfirmDialog(true);\n  };\n\n  const handleConfirmRegenerate = () => {\n    regenerateToken.mutate();\n  };\n\n  const handleCopyToken = async () => {\n    try {\n      await navigator.clipboard.writeText(plaintextToken);\n      setCopied(true);\n      toast({\n        title: \"Token copied\",\n        description: \"Access token has been copied to clipboard.\",\n      });\n      setTimeout(() => setCopied(false), 2000);\n    } catch (error) {\n      toast({\n        title: \"Failed to copy\",\n        description: \"Please copy the token manually.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCloseTokenDialog = () => {\n    setShowTokenDialog(false);\n    setPlaintextToken(\"\");\n    setCopied(false);\n  };\n\n  if (loadingPatient) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-10 w-48\" />\n        <Card className=\"p-6\">\n          <div className=\"flex items-start gap-6\">\n            <Skeleton className=\"h-20 w-20 rounded-full\" />\n            <div className=\"flex-1 space-y-4\">\n              <Skeleton className=\"h-8 w-64\" />\n              <Skeleton className=\"h-4 w-32\" />\n              <Skeleton className=\"h-4 w-full\" />\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!patient) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground\">Patient not found</p>\n      </div>\n    );\n  }\n\n  const initials = patient.name\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n          </Link>\n          <h1 className=\"text-3xl font-medium text-foreground\">Patient Details</h1>\n        </div>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-start gap-6 flex-wrap\">\n            <Avatar className=\"h-20 w-20\">\n              <AvatarFallback className=\"bg-primary text-primary-foreground text-2xl\">\n                {initials}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1 min-w-0\">\n              <h2 className=\"text-2xl font-medium text-card-foreground\" data-testid=\"text-patient-name\">\n                {patient.name}\n              </h2>\n              <p className=\"text-sm text-muted-foreground font-mono mt-2\" data-testid=\"text-patient-id\">\n                Patient ID: {patient.patientId}\n              </p>\n              <div className=\"flex items-center gap-4 mt-4 flex-wrap\">\n                <Badge variant=\"secondary\">{patient.gender}</Badge>\n                {patient.fitzpatrickType && (\n                  <Badge variant=\"outline\">\n                    Fitzpatrick Type {patient.fitzpatrickType}\n                  </Badge>\n                )}\n              </div>\n            </div>\n            <Link href={`/capture?patientId=${patient.id}`}>\n              <Button data-testid=\"button-capture-lesion\">\n                <Activity className=\"h-4 w-4 mr-2\" />\n                Capture Lesion\n              </Button>\n            </Link>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-8 pt-8 border-t border-border\">\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-3 text-sm\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Date of Birth:</span>\n                <span className=\"text-card-foreground\">\n                  {format(new Date(patient.dateOfBirth), \"MMM d, yyyy\")}\n                </span>\n              </div>\n              {patient.contactEmail && (\n                <div className=\"flex items-center gap-3 text-sm\">\n                  <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"text-muted-foreground\">Email:</span>\n                  <span className=\"text-card-foreground\">{patient.contactEmail}</span>\n                </div>\n              )}\n              {patient.contactPhone && (\n                <div className=\"flex items-center gap-3 text-sm\">\n                  <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"text-muted-foreground\">Phone:</span>\n                  <span className=\"text-card-foreground\">{patient.contactPhone}</span>\n                </div>\n              )}\n            </div>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-3 text-sm\">\n                <User className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground\">Record Created:</span>\n                <span className=\"text-card-foreground\">\n                  {format(new Date(patient.createdAt), \"MMM d, yyyy\")}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Patient Portal Access Section */}\n          <div className=\"mt-8 pt-8 border-t border-border\">\n            <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Shield className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h3 className=\"text-base font-medium text-card-foreground\">Patient Portal Access</h3>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Secure access token for patient to view their records\n                  </p>\n                </div>\n              </div>\n              <Button\n                variant=\"outline\"\n                onClick={handleRegenerateClick}\n                disabled={regenerateToken.isPending}\n                data-testid=\"button-regenerate-token\"\n              >\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                {regenerateToken.isPending ? \"Regenerating...\" : \"Regenerate Token\"}\n              </Button>\n            </div>\n            <div className=\"mt-4 p-4 rounded-md bg-muted\">\n              <p className=\"text-xs text-muted-foreground\">\n                The patient uses their access token along with their Patient ID, name, and date of birth to securely access the portal. If the token is lost, you can regenerate a new one here.\n              </p>\n            </div>\n          </div>\n        </Card>\n\n        <div>\n          <h2 className=\"text-xl font-medium text-foreground mb-4\">Lesion History</h2>\n          {loadingLesions ? (\n            <div className=\"space-y-4\">\n              {[1, 2].map((i) => (\n                <Card key={i} className=\"p-6\">\n                  <Skeleton className=\"h-48 w-full\" />\n                </Card>\n              ))}\n            </div>\n          ) : lesions && lesions.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {lesions.map((lesion) => (\n                <Card key={lesion.id} className=\"p-4 hover-elevate active-elevate-2\">\n                  <div className=\"aspect-square rounded-md border border-border overflow-hidden mb-3 bg-muted\">\n                    <img\n                      src={lesion.imagePath}\n                      alt={`Lesion at ${lesion.location}`}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm font-medium text-card-foreground\">\n                        {lesion.location}\n                      </span>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {format(new Date(lesion.capturedAt), \"MMM d\")}\n                      </Badge>\n                    </div>\n                    {lesion.analysis && (\n                      <div className=\"pt-2 border-t border-border\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span className=\"text-muted-foreground\">Classification:</span>\n                          <span className=\"font-medium\">{lesion.analysis.classification}</span>\n                        </div>\n                        <div className=\"flex items-center justify-between text-sm mt-1\">\n                          <span className=\"text-muted-foreground\">Confidence:</span>\n                          <span className=\"font-mono\">{lesion.analysis.confidence}%</span>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <Card className=\"p-12 text-center\">\n              <Activity className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-card-foreground\">No lesions captured</h3>\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Start by capturing the first lesion image\n              </p>\n              <Link href={`/capture?patientId=${patient.id}`}>\n                <Button className=\"mt-4\" data-testid=\"button-capture-first-lesion\">\n                  <Activity className=\"h-4 w-4 mr-2\" />\n                  Capture Lesion\n                </Button>\n              </Link>\n            </Card>\n          )}\n        </div>\n      </div>\n\n      {/* Confirmation Dialog */}\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Regenerate Access Token?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will invalidate the current access token and generate a new one. The patient will need the new token to access the portal.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-regenerate\">Cancel</AlertDialogCancel>\n            <AlertDialogAction onClick={handleConfirmRegenerate} data-testid=\"button-confirm-regenerate\">\n              Regenerate Token\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Token Reveal Dialog - One-time viewing */}\n      <Dialog open={showTokenDialog} onOpenChange={() => {}}>\n        <DialogContent className=\"max-w-lg\" onPointerDownOutside={(e) => e.preventDefault()}>\n          <DialogHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                <Shield className=\"h-6 w-6 text-primary\" />\n              </div>\n              <div>\n                <DialogTitle className=\"text-xl\">New Access Token Generated</DialogTitle>\n                <DialogDescription className=\"mt-1\">\n                  Share this token with the patient for portal access\n                </DialogDescription>\n              </div>\n            </div>\n          </DialogHeader>\n\n          <div className=\"space-y-4 py-4\">\n            <div className=\"p-4 rounded-md bg-muted border-2 border-border\">\n              <p className=\"text-sm text-muted-foreground mb-2 font-medium\">Access Token</p>\n              <div className=\"flex items-center gap-2\">\n                <code className=\"flex-1 text-sm font-mono bg-background px-3 py-2 rounded border border-border break-all\" data-testid=\"text-token\">\n                  {plaintextToken}\n                </code>\n                <Button\n                  variant=\"outline\"\n                  size=\"icon\"\n                  onClick={handleCopyToken}\n                  data-testid=\"button-copy-token\"\n                >\n                  {copied ? (\n                    <Check className=\"h-4 w-4 text-primary\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 p-4 rounded-md bg-destructive/10 border border-destructive/30\">\n              <AlertCircle className=\"h-5 w-5 text-destructive flex-shrink-0 mt-0.5\" />\n              <div className=\"space-y-2\">\n                <p className=\"text-sm font-medium text-destructive\">Important Security Notice</p>\n                <ul className=\"text-xs text-destructive/90 space-y-1 list-disc list-inside\">\n                  <li>This token will only be shown once - copy it now</li>\n                  <li>Share this token securely with the patient</li>\n                  <li>The previous token has been invalidated</li>\n                  <li>Patient will need this token along with their ID, name, and date of birth</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button\n              onClick={handleCloseTokenDialog}\n              className=\"w-full\"\n              data-testid=\"button-confirm\"\n            >\n              I've Saved the Token\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":16061},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"server/storage.ts":{"content":"import {\n  type User,\n  type InsertUser,\n  type Patient,\n  type InsertPatient,\n  type Lesion,\n  type InsertLesion,\n  type Analysis,\n  type InsertAnalysis,\n  type PatientToken,\n  type InsertPatientToken,\n  type PortalAccessLog,\n  type InsertPortalAccessLog,\n  type FairnessAuditRun,\n  type InsertFairnessAuditRun,\n  type FairnessMetric,\n  type InsertFairnessMetric,\n  users,\n  patients,\n  lesions,\n  analyses,\n  patientTokens,\n  portalAccessLogs,\n  fairnessAuditRuns,\n  fairnessMetrics,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, gte, sql, isNotNull, and, lte } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n\n  // Patients\n  getPatient(id: string): Promise<Patient | undefined>;\n  getPatientByPatientId(patientId: string): Promise<Patient | undefined>;\n  getPatientByTokenLookupHash(lookupHash: string): Promise<Patient | undefined>;\n  getAllPatients(): Promise<Patient[]>;\n  createPatient(patient: InsertPatient, accessToken: string, tokenLookupHash: string): Promise<Patient>;\n  updatePatient(id: string, patient: Partial<Patient>): Promise<Patient | undefined>;\n\n  // Lesions\n  getLesion(id: string): Promise<Lesion | undefined>;\n  getLesionsByPatientId(patientId: string): Promise<Lesion[]>;\n  createLesion(lesion: InsertLesion): Promise<Lesion>;\n\n  // Analyses\n  getAnalysis(id: string): Promise<Analysis | undefined>;\n  getAnalysisByLesionId(lesionId: string): Promise<Analysis | undefined>;\n  getAllAnalyses(): Promise<Analysis[]>;\n  createAnalysis(analysis: InsertAnalysis): Promise<Analysis>;\n  updateAnalysisGroundTruth(\n    id: string,\n    groundTruthLabel: string,\n    groundTruthSource: string\n  ): Promise<Analysis | undefined>;\n  getAnalysesWithGroundTruth(startDate: Date, endDate: Date): Promise<\n    Array<{\n      analysis: Analysis;\n      lesion: Lesion;\n      patient: Patient;\n    }>\n  >;\n  getAnalysesCountInDateRange(startDate: Date, endDate: Date): Promise<number>;\n\n  // Patient Tokens\n  getPatientToken(token: string): Promise<PatientToken | undefined>;\n  createPatientToken(tokenData: InsertPatientToken): Promise<PatientToken>;\n  deleteExpiredTokens(): Promise<void>;\n\n  // Portal Access Audit Logging\n  createPortalAccessLog(log: InsertPortalAccessLog): Promise<PortalAccessLog>;\n  getRecentPortalAccessAttempts(minutesAgo: number, ipAddress?: string): Promise<number>;\n\n  // Fairness Audit\n  createFairnessAuditRun(auditRun: InsertFairnessAuditRun): Promise<FairnessAuditRun>;\n  getFairnessAuditRuns(limit?: number): Promise<FairnessAuditRun[]>;\n  getLatestFairnessAuditRun(): Promise<FairnessAuditRun | undefined>;\n  createFairnessMetrics(metrics: InsertFairnessMetric[]): Promise<FairnessMetric[]>;\n  getFairnessMetricsByAuditRunId(auditRunId: string): Promise<FairnessMetric[]>;\n\n  // Stats\n  getStats(): Promise<{\n    totalPatients: number;\n    totalLesions: number;\n    recentAnalyses: number;\n  }>;\n}\n\nexport class DbStorage implements IStorage {\n  // Users\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id));\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, username));\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  // Patients\n  async getPatient(id: string): Promise<Patient | undefined> {\n    const result = await db.select().from(patients).where(eq(patients.id, id));\n    return result[0];\n  }\n\n  async getPatientByPatientId(patientId: string): Promise<Patient | undefined> {\n    const result = await db.select().from(patients).where(eq(patients.patientId, patientId));\n    return result[0];\n  }\n\n  async getPatientByTokenLookupHash(lookupHash: string): Promise<Patient | undefined> {\n    const result = await db.select().from(patients).where(eq(patients.tokenLookupHash, lookupHash));\n    return result[0];\n  }\n\n  async getAllPatients(): Promise<Patient[]> {\n    return await db.select().from(patients).orderBy(desc(patients.createdAt));\n  }\n\n  async createPatient(insertPatient: InsertPatient, accessToken: string, tokenLookupHash: string): Promise<Patient> {\n    const result = await db.insert(patients).values({ ...insertPatient, accessToken, tokenLookupHash }).returning();\n    return result[0];\n  }\n\n  async updatePatient(id: string, updates: Partial<Patient>): Promise<Patient | undefined> {\n    const result = await db\n      .update(patients)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(patients.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Lesions\n  async getLesion(id: string): Promise<Lesion | undefined> {\n    const result = await db.select().from(lesions).where(eq(lesions.id, id));\n    return result[0];\n  }\n\n  async getLesionsByPatientId(patientId: string): Promise<Lesion[]> {\n    return await db\n      .select()\n      .from(lesions)\n      .where(eq(lesions.patientId, patientId))\n      .orderBy(desc(lesions.capturedAt));\n  }\n\n  async createLesion(insertLesion: InsertLesion): Promise<Lesion> {\n    const result = await db.insert(lesions).values(insertLesion).returning();\n    return result[0];\n  }\n\n  // Analyses\n  async getAnalysis(id: string): Promise<Analysis | undefined> {\n    const result = await db.select().from(analyses).where(eq(analyses.id, id));\n    return result[0];\n  }\n\n  async getAnalysisByLesionId(lesionId: string): Promise<Analysis | undefined> {\n    const result = await db.select().from(analyses).where(eq(analyses.lesionId, lesionId));\n    return result[0];\n  }\n\n  async getAllAnalyses(): Promise<Analysis[]> {\n    return await db.select().from(analyses).orderBy(desc(analyses.analyzedAt));\n  }\n\n  async createAnalysis(insertAnalysis: InsertAnalysis): Promise<Analysis> {\n    const result = await db.insert(analyses).values(insertAnalysis).returning();\n    return result[0];\n  }\n\n  async updateAnalysisGroundTruth(\n    id: string,\n    groundTruthLabel: string,\n    groundTruthSource: string\n  ): Promise<Analysis | undefined> {\n    const result = await db\n      .update(analyses)\n      .set({\n        groundTruthLabel,\n        groundTruthSource,\n        groundTruthRecordedAt: new Date(),\n      })\n      .where(eq(analyses.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getAnalysesWithGroundTruth(startDate: Date, endDate: Date): Promise<\n    Array<{\n      analysis: Analysis;\n      lesion: Lesion;\n      patient: Patient;\n    }>\n  > {\n    const analysesData = await db\n      .select()\n      .from(analyses)\n      .where(\n        and(\n          isNotNull(analyses.groundTruthLabel),\n          gte(analyses.analyzedAt, startDate),\n          lte(analyses.analyzedAt, endDate)\n        )\n      );\n\n    const results = await Promise.all(\n      analysesData.map(async (analysis) => {\n        const lesion = await this.getLesion(analysis.lesionId);\n        if (!lesion) {\n          throw new Error(`Lesion not found for analysis ${analysis.id}`);\n        }\n        const patient = await this.getPatient(lesion.patientId);\n        if (!patient) {\n          throw new Error(`Patient not found for lesion ${lesion.id}`);\n        }\n        return { analysis, lesion, patient };\n      })\n    );\n\n    return results;\n  }\n\n  async getAnalysesCountInDateRange(startDate: Date, endDate: Date): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(analyses)\n      .where(\n        and(\n          gte(analyses.analyzedAt, startDate),\n          lte(analyses.analyzedAt, endDate)\n        )\n      );\n    \n    return Number(result[0].count);\n  }\n\n  // Patient Tokens\n  async getPatientToken(token: string): Promise<PatientToken | undefined> {\n    const result = await db\n      .select()\n      .from(patientTokens)\n      .where(eq(patientTokens.token, token));\n    \n    if (!result[0]) return undefined;\n    \n    if (new Date(result[0].expiresAt) < new Date()) {\n      await db.delete(patientTokens).where(eq(patientTokens.token, token));\n      return undefined;\n    }\n    \n    return result[0];\n  }\n\n  async createPatientToken(insertToken: InsertPatientToken): Promise<PatientToken> {\n    const result = await db.insert(patientTokens).values(insertToken).returning();\n    return result[0];\n  }\n\n  async deleteExpiredTokens(): Promise<void> {\n    await db.delete(patientTokens).where(gte(patientTokens.expiresAt, new Date()));\n  }\n\n  // Portal Access Audit Logging\n  async createPortalAccessLog(insertLog: InsertPortalAccessLog): Promise<PortalAccessLog> {\n    const result = await db.insert(portalAccessLogs).values(insertLog).returning();\n    return result[0];\n  }\n\n  async getRecentPortalAccessAttempts(minutesAgo: number, ipAddress?: string): Promise<number> {\n    const timeThreshold = new Date(Date.now() - minutesAgo * 60 * 1000);\n    const conditions = [gte(portalAccessLogs.createdAt, timeThreshold)];\n    \n    if (ipAddress) {\n      conditions.push(eq(portalAccessLogs.ipAddress, ipAddress));\n    }\n    \n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(portalAccessLogs)\n      .where(and(...conditions));\n    \n    return Number(result[0].count);\n  }\n\n  // Fairness Audit\n  async createFairnessAuditRun(insertAuditRun: InsertFairnessAuditRun): Promise<FairnessAuditRun> {\n    const result = await db.insert(fairnessAuditRuns).values(insertAuditRun).returning();\n    return result[0];\n  }\n\n  async getFairnessAuditRuns(limit: number = 10): Promise<FairnessAuditRun[]> {\n    return await db\n      .select()\n      .from(fairnessAuditRuns)\n      .orderBy(desc(fairnessAuditRuns.runAt))\n      .limit(limit);\n  }\n\n  async getLatestFairnessAuditRun(): Promise<FairnessAuditRun | undefined> {\n    const result = await db\n      .select()\n      .from(fairnessAuditRuns)\n      .orderBy(desc(fairnessAuditRuns.runAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async createFairnessMetrics(insertMetrics: InsertFairnessMetric[]): Promise<FairnessMetric[]> {\n    if (insertMetrics.length === 0) return [];\n    const result = await db.insert(fairnessMetrics).values(insertMetrics).returning();\n    return result;\n  }\n\n  async getFairnessMetricsByAuditRunId(auditRunId: string): Promise<FairnessMetric[]> {\n    return await db\n      .select()\n      .from(fairnessMetrics)\n      .where(eq(fairnessMetrics.auditRunId, auditRunId));\n  }\n\n  // Stats\n  async getStats(): Promise<{\n    totalPatients: number;\n    totalLesions: number;\n    recentAnalyses: number;\n  }> {\n    const sevenDaysAgo = new Date();\n    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\n    const [patientCount] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(patients);\n\n    const [lesionCount] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(lesions);\n\n    const [recentAnalysisCount] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(analyses)\n      .where(gte(analyses.analyzedAt, sevenDaysAgo));\n\n    return {\n      totalPatients: Number(patientCount.count),\n      totalLesions: Number(lesionCount.count),\n      recentAnalyses: Number(recentAnalysisCount.count),\n    };\n  }\n}\n\n// Use DbStorage for persistent database storage\nexport const storage = new DbStorage();\n","size_bytes":11458},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/analysis-result-card.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { AlertCircle, CheckCircle, AlertTriangle } from \"lucide-react\";\nimport type { Analysis } from \"@shared/schema\";\n\ninterface AnalysisResultCardProps {\n  analysis: Analysis;\n}\n\nexport function AnalysisResultCard({ analysis }: AnalysisResultCardProps) {\n  const getClassificationColor = (classification: string) => {\n    switch (classification.toLowerCase()) {\n      case \"benign\":\n        return \"success\";\n      case \"malignant\":\n        return \"destructive\";\n      case \"rash\":\n        return \"warning\";\n      case \"infection\":\n        return \"warning\";\n      default:\n        return \"secondary\";\n    }\n  };\n\n  const getClassificationIcon = (classification: string) => {\n    switch (classification.toLowerCase()) {\n      case \"benign\":\n        return <CheckCircle className=\"h-5 w-5\" />;\n      case \"malignant\":\n        return <AlertCircle className=\"h-5 w-5\" />;\n      default:\n        return <AlertTriangle className=\"h-5 w-5\" />;\n    }\n  };\n\n  const scores = [\n    { label: \"Benign\", value: analysis.benignScore, color: \"bg-success\" },\n    { label: \"Malignant\", value: analysis.malignantScore, color: \"bg-destructive\" },\n    { label: \"Rash\", value: analysis.rashScore, color: \"bg-warning\" },\n    { label: \"Infection\", value: analysis.infectionScore, color: \"bg-chart-3\" },\n  ];\n\n  return (\n    <Card className=\"p-6\">\n      <div className=\"space-y-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-3 mb-2\">\n              {getClassificationIcon(analysis.classification)}\n              <h3 className=\"text-2xl font-medium text-card-foreground\" data-testid=\"text-classification\">\n                {analysis.classification}\n              </h3>\n            </div>\n            <Badge\n              variant={getClassificationColor(analysis.classification) as any}\n              className=\"text-sm\"\n              data-testid=\"badge-classification\"\n            >\n              Classification\n            </Badge>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-4xl font-medium text-card-foreground\" data-testid=\"text-confidence\">\n              {analysis.confidence}%\n            </div>\n            <p className=\"text-sm text-muted-foreground mt-1\">Confidence</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <h4 className=\"text-sm font-medium text-card-foreground\">Score Breakdown</h4>\n          {scores.map((score) => (\n            <div key={score.label} className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-muted-foreground\">{score.label}</span>\n                <span className=\"font-mono text-card-foreground\" data-testid={`text-score-${score.label.toLowerCase()}`}>\n                  {score.value}%\n                </span>\n              </div>\n              <Progress value={score.value} className=\"h-2\" />\n            </div>\n          ))}\n        </div>\n\n        {analysis.aiResponse && (\n          <div className=\"border-l-4 border-primary bg-primary/5 p-4 rounded-md\">\n            <h4 className=\"text-sm font-medium text-card-foreground mb-2\">AI Analysis</h4>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\" data-testid=\"text-ai-response\">\n              {analysis.aiResponse}\n            </p>\n          </div>\n        )}\n      </div>\n    </Card>\n  );\n}\n","size_bytes":3577},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        success: {\n          DEFAULT: \"hsl(var(--success) / <alpha-value>)\",\n          foreground: \"hsl(var(--success-foreground) / <alpha-value>)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(var(--warning) / <alpha-value>)\",\n          foreground: \"hsl(var(--warning-foreground) / <alpha-value>)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n      },\n      fontFamily: {\n        sans: [\"Roboto\", \"sans-serif\"],\n        serif: [\"Georgia\", \"serif\"],\n        mono: [\"Roboto Mono\", \"monospace\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4160},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/pages/progress-tracker.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { LesionComparison } from \"@/components/lesion-comparison\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { TrendingUp, ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport type { Patient, Lesion, Analysis } from \"@shared/schema\";\n\nexport default function ProgressTracker() {\n  const [selectedPatientId, setSelectedPatientId] = useState<string>(\"\");\n  const [selectedLesion1Id, setSelectedLesion1Id] = useState<string>(\"\");\n  const [selectedLesion2Id, setSelectedLesion2Id] = useState<string>(\"\");\n\n  const { data: patients } = useQuery<Patient[]>({\n    queryKey: [\"/api/patients\"],\n  });\n\n  const { data: lesions, isLoading: loadingLesions } = useQuery<\n    (Lesion & { analysis?: Analysis })[]\n  >({\n    queryKey: [\"/api/patients\", selectedPatientId, \"lesions\"],\n    enabled: !!selectedPatientId,\n  });\n\n  const lesion1 = lesions?.find((l) => l.id === selectedLesion1Id);\n  const lesion2 = lesions?.find((l) => l.id === selectedLesion2Id);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Link href=\"/\">\n          <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-3xl font-medium text-foreground\">Progress Tracker</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Compare lesion images over time\n          </p>\n        </div>\n      </div>\n\n      <Card className=\"p-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-2 block\">\n              Select Patient\n            </label>\n            <Select\n              value={selectedPatientId}\n              onValueChange={(value) => {\n                setSelectedPatientId(value);\n                setSelectedLesion1Id(\"\");\n                setSelectedLesion2Id(\"\");\n              }}\n            >\n              <SelectTrigger data-testid=\"select-patient\">\n                <SelectValue placeholder=\"Choose patient\" />\n              </SelectTrigger>\n              <SelectContent>\n                {patients?.map((patient) => (\n                  <SelectItem key={patient.id} value={patient.id}>\n                    {patient.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-2 block\">\n              Before (Earlier)\n            </label>\n            <Select\n              value={selectedLesion1Id}\n              onValueChange={setSelectedLesion1Id}\n              disabled={!selectedPatientId || loadingLesions}\n            >\n              <SelectTrigger data-testid=\"select-lesion-before\">\n                <SelectValue placeholder=\"Select lesion\" />\n              </SelectTrigger>\n              <SelectContent>\n                {lesions?.map((lesion) => (\n                  <SelectItem\n                    key={lesion.id}\n                    value={lesion.id}\n                    disabled={lesion.id === selectedLesion2Id}\n                  >\n                    {lesion.location} - {new Date(lesion.capturedAt).toLocaleDateString()}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium text-foreground mb-2 block\">\n              After (Recent)\n            </label>\n            <Select\n              value={selectedLesion2Id}\n              onValueChange={setSelectedLesion2Id}\n              disabled={!selectedPatientId || loadingLesions}\n            >\n              <SelectTrigger data-testid=\"select-lesion-after\">\n                <SelectValue placeholder=\"Select lesion\" />\n              </SelectTrigger>\n              <SelectContent>\n                {lesions?.map((lesion) => (\n                  <SelectItem\n                    key={lesion.id}\n                    value={lesion.id}\n                    disabled={lesion.id === selectedLesion1Id}\n                  >\n                    {lesion.location} - {new Date(lesion.capturedAt).toLocaleDateString()}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </Card>\n\n      {loadingLesions ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {[1, 2].map((i) => (\n            <Card key={i} className=\"p-6\">\n              <Skeleton className=\"h-64 w-full\" />\n            </Card>\n          ))}\n        </div>\n      ) : lesion1 && lesion2 ? (\n        <LesionComparison lesion1={lesion1} lesion2={lesion2} />\n      ) : (\n        <Card className=\"p-12 text-center\">\n          <TrendingUp className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-card-foreground\">\n            Select lesions to compare\n          </h3>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            Choose a patient and two lesion images to track progress over time\n          </p>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":5513},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-http\";\nimport { neon } from \"@neondatabase/serverless\";\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set\");\n}\n\nconst sql = neon(process.env.DATABASE_URL);\nexport const db = drizzle(sql, { schema });\n","size_bytes":312},"client/src/components/image-upload.tsx":{"content":"import { useCallback, useState } from \"react\";\nimport { Upload, X, Camera } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\n\ninterface ImageUploadProps {\n  onImageSelect: (file: File) => void;\n  value?: File | null;\n  disabled?: boolean;\n}\n\nexport function ImageUpload({ onImageSelect, value, disabled }: ImageUploadProps) {\n  const [preview, setPreview] = useState<string | null>(null);\n  const [dragActive, setDragActive] = useState(false);\n\n  const handleFile = useCallback(\n    (file: File) => {\n      if (file && file.type.startsWith(\"image/\")) {\n        onImageSelect(file);\n        const reader = new FileReader();\n        reader.onloadend = () => {\n          setPreview(reader.result as string);\n        };\n        reader.readAsDataURL(file);\n      }\n    },\n    [onImageSelect]\n  );\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      handleFile(e.dataTransfer.files[0]);\n    }\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    e.preventDefault();\n    if (e.target.files && e.target.files[0]) {\n      handleFile(e.target.files[0]);\n    }\n  };\n\n  const handleClear = () => {\n    setPreview(null);\n    onImageSelect(null as any);\n  };\n\n  return (\n    <div className=\"w-full\">\n      {preview ? (\n        <Card className=\"relative overflow-hidden\">\n          <img\n            src={preview}\n            alt=\"Preview\"\n            className=\"w-full h-auto max-h-96 object-contain\"\n            data-testid=\"img-preview\"\n          />\n          <Button\n            variant=\"destructive\"\n            size=\"icon\"\n            className=\"absolute top-4 right-4\"\n            onClick={handleClear}\n            disabled={disabled}\n            data-testid=\"button-clear-image\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </Card>\n      ) : (\n        <Card\n          className={`border-2 border-dashed p-8 text-center hover-elevate transition-colors ${\n            dragActive ? \"border-primary bg-primary/5\" : \"border-border\"\n          }`}\n          onDragEnter={handleDrag}\n          onDragLeave={handleDrag}\n          onDragOver={handleDrag}\n          onDrop={handleDrop}\n        >\n          <input\n            type=\"file\"\n            id=\"image-upload\"\n            className=\"hidden\"\n            accept=\"image/*\"\n            onChange={handleChange}\n            disabled={disabled}\n            data-testid=\"input-image-upload\"\n          />\n          <label\n            htmlFor=\"image-upload\"\n            className=\"cursor-pointer flex flex-col items-center gap-4\"\n          >\n            <div className=\"rounded-full bg-primary/10 p-6\">\n              <Camera className=\"h-8 w-8 text-primary\" />\n            </div>\n            <div>\n              <p className=\"text-base font-medium text-foreground\">\n                Drop lesion image here or click to upload\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Supports JPG, PNG up to 10MB\n              </p>\n            </div>\n            <Button type=\"button\" variant=\"outline\" disabled={disabled} data-testid=\"button-select-image\">\n              <Upload className=\"h-4 w-4 mr-2\" />\n              Select Image\n            </Button>\n          </label>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":3712},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ArrowLeft, FileText, Download, Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { format } from \"date-fns\";\nimport type { Patient, Lesion, Analysis } from \"@shared/schema\";\n\nexport default function Reports() {\n  const { toast } = useToast();\n  const [selectedPatientId, setSelectedPatientId] = useState<string>(\"\");\n\n  const { data: patients } = useQuery<Patient[]>({\n    queryKey: [\"/api/patients\"],\n  });\n\n  const { data: patientData } = useQuery<{\n    patient: Patient;\n    lesions: (Lesion & { analysis?: Analysis })[];\n  }>({\n    queryKey: [\"/api/patients\", selectedPatientId, \"report-data\"],\n    enabled: !!selectedPatientId,\n  });\n\n  const generateReport = useMutation({\n    mutationFn: async (patientId: string) => {\n      const response = await fetch(`/api/reports/generate/${patientId}`, {\n        method: \"POST\",\n      });\n      if (!response.ok) {\n        throw new Error(await response.text());\n      }\n      return response.blob();\n    },\n    onSuccess: (blob, patientId) => {\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `patient-report-${patientId}-${Date.now()}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n      toast({\n        title: \"Report generated\",\n        description: \"PDF report has been downloaded successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Generation failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Link href=\"/\">\n          <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-3xl font-medium text-foreground\">Reports</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Generate comprehensive PDF reports\n          </p>\n        </div>\n      </div>\n\n      <Card className=\"p-6\">\n        <div className=\"flex items-end gap-4\">\n          <div className=\"flex-1\">\n            <label className=\"text-sm font-medium text-foreground mb-2 block\">\n              Select Patient\n            </label>\n            <Select value={selectedPatientId} onValueChange={setSelectedPatientId}>\n              <SelectTrigger data-testid=\"select-patient\">\n                <SelectValue placeholder=\"Choose patient for report\" />\n              </SelectTrigger>\n              <SelectContent>\n                {patients?.map((patient) => (\n                  <SelectItem key={patient.id} value={patient.id}>\n                    {patient.name} ({patient.patientId})\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <Button\n            onClick={() => generateReport.mutate(selectedPatientId)}\n            disabled={!selectedPatientId || generateReport.isPending}\n            data-testid=\"button-generate-report\"\n          >\n            {generateReport.isPending ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                Generating...\n              </>\n            ) : (\n              <>\n                <Download className=\"h-4 w-4 mr-2\" />\n                Generate PDF\n              </>\n            )}\n          </Button>\n        </div>\n      </Card>\n\n      {patientData && (\n        <>\n          <Card className=\"p-6\">\n            <h2 className=\"text-xl font-medium text-card-foreground mb-4\">\n              Report Preview\n            </h2>\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4 border-b border-border\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Patient Name</p>\n                  <p className=\"text-base font-medium text-card-foreground\">\n                    {patientData.patient.name}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Patient ID</p>\n                  <p className=\"text-base font-mono text-card-foreground\">\n                    {patientData.patient.patientId}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Date of Birth</p>\n                  <p className=\"text-base text-card-foreground\">\n                    {format(new Date(patientData.patient.dateOfBirth), \"MMM d, yyyy\")}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Total Lesions</p>\n                  <p className=\"text-base text-card-foreground\">\n                    {patientData.lesions.length}\n                  </p>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-base font-medium text-card-foreground mb-3\">\n                  Lesion Summary\n                </h3>\n                {patientData.lesions.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {patientData.lesions.map((lesion) => (\n                      <div\n                        key={lesion.id}\n                        className=\"flex items-center justify-between p-3 rounded-md bg-muted\"\n                      >\n                        <div>\n                          <p className=\"text-sm font-medium text-card-foreground\">\n                            {lesion.location}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {format(new Date(lesion.capturedAt), \"MMM d, yyyy\")}\n                          </p>\n                        </div>\n                        {lesion.analysis && (\n                          <div className=\"flex items-center gap-3\">\n                            <Badge variant=\"outline\">{lesion.analysis.classification}</Badge>\n                            <span className=\"text-sm font-mono text-muted-foreground\">\n                              {lesion.analysis.confidence}%\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">No lesions recorded</p>\n                )}\n              </div>\n            </div>\n          </Card>\n        </>\n      )}\n\n      {!selectedPatientId && (\n        <Card className=\"p-12 text-center\">\n          <FileText className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-card-foreground\">\n            Select a patient to generate report\n          </h3>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            Comprehensive PDF reports include patient info, lesion history, and AI analysis\n          </p>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":7591},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { PatientCard } from \"@/components/patient-card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Search, Users, Activity, TrendingUp, Brain } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport type { Patient, Analysis, Lesion } from \"@shared/schema\";\nimport { PieChart, Pie, Cell, BarChart, Bar, LineChart as RechartsLineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { motion } from 'framer-motion';\n\n// Mock data for charts (in a real app, this would come from API)\nconst severityData = [\n  { name: 'Mild', value: 45, color: '#10b981' },\n  { name: 'Moderate', value: 32, color: '#f59e0b' },\n  { name: 'Severe', value: 23, color: '#ef4444' }\n];\n\nconst diseaseTypeData = [\n  { name: 'Eczema', count: 28, color: '#8b5cf6' },\n  { name: 'Psoriasis', count: 22, color: '#ec4899' },\n  { name: 'Acne', count: 35, color: '#3b82f6' },\n  { name: 'Cellulitis', count: 15, color: '#f59e0b' },\n  { name: 'Melanoma', count: 8, color: '#ef4444' },\n  { name: 'Other', count: 12, color: '#6b7280' }\n];\n\nconst improvementTrendData = [\n  { month: 'Jan', improvement: 65 },\n  { month: 'Feb', improvement: 70 },\n  { month: 'Mar', improvement: 68 },\n  { month: 'Apr', improvement: 75 },\n  { month: 'May', improvement: 82 },\n  { month: 'Jun', improvement: 88 }\n];\n\n// Animated counter component\nfunction AnimatedCounter({ value }: { value: number }) {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    const duration = 1000;\n    const steps = 30;\n    const increment = value / steps;\n    let current = 0;\n\n    const timer = setInterval(() => {\n      current += increment;\n      if (current >= value) {\n        setCount(value);\n        clearInterval(timer);\n      } else {\n        setCount(Math.floor(current));\n      }\n    }, duration / steps);\n\n    return () => clearInterval(timer);\n  }, [value]);\n\n  return <span>{count}</span>;\n}\n\nexport default function Dashboard() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: patients, isLoading } = useQuery<Patient[]>({\n    queryKey: [\"/api/patients\"],\n  });\n\n  const { data: stats } = useQuery<{\n    totalPatients: number;\n    totalLesions: number;\n    recentAnalyses: number;\n  }>({\n    queryKey: [\"/api/stats\"],\n  });\n\n  const { data: analyses } = useQuery<(Analysis & { lesion?: Lesion & { patient?: Patient } })[]>({\n    queryKey: [\"/api/analyses\"],\n  });\n\n  const filteredPatients = patients?.filter(\n    (p) =>\n      p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      p.patientId.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  // Get recent analyses with images (limit to 6)\n  const recentAnalysesWithImages = (analyses ?? []).filter(a => a.lesion?.imagePath).slice(0, 6);\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Header with gradient background */}\n      <div className=\"relative pb-6\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-primary/5 via-primary/10 to-primary/5 rounded-lg -z-10\" />\n        <div className=\"pt-6 px-4\">\n          <h1 className=\"text-3xl font-medium text-foreground\">Dashboard</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Manage patients and track dermatological progress\n          </p>\n        </div>\n      </div>\n\n      {/* Stats Cards with animations */}\n      <motion.div \n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3 }}\n        className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\"\n      >\n        <Card className=\"p-6 shadow-md hover:shadow-lg transition-shadow duration-300\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Total Patients</p>\n              <p className=\"text-3xl font-medium text-card-foreground mt-2\" data-testid=\"text-total-patients\">\n                <AnimatedCounter value={stats?.totalPatients || 0} />\n              </p>\n            </div>\n            <div className=\"h-12 w-12 rounded-md bg-primary/10 flex items-center justify-center\">\n              <Users className=\"h-6 w-6 text-primary\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6 shadow-md hover:shadow-lg transition-shadow duration-300\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Total Lesions</p>\n              <p className=\"text-3xl font-medium text-card-foreground mt-2\" data-testid=\"text-total-lesions\">\n                <AnimatedCounter value={stats?.totalLesions || 0} />\n              </p>\n            </div>\n            <div className=\"h-12 w-12 rounded-md bg-success/10 flex items-center justify-center\">\n              <Activity className=\"h-6 w-6 text-success\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6 shadow-md hover:shadow-lg transition-shadow duration-300\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Recent Analyses</p>\n              <p className=\"text-3xl font-medium text-card-foreground mt-2\" data-testid=\"text-recent-analyses\">\n                <AnimatedCounter value={stats?.recentAnalyses || 0} />\n              </p>\n            </div>\n            <div className=\"h-12 w-12 rounded-md bg-warning/10 flex items-center justify-center\">\n              <TrendingUp className=\"h-6 w-6 text-warning\" />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6 shadow-md hover:shadow-lg transition-shadow duration-300\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Model Accuracy</p>\n              <p className=\"text-3xl font-medium text-card-foreground mt-2\">\n                91.4%\n              </p>\n              <p className=\"text-xs text-muted-foreground mt-1\">Updated today</p>\n            </div>\n            <div className=\"h-12 w-12 rounded-md bg-primary/10 flex items-center justify-center\">\n              <Brain className=\"h-6 w-6 text-primary\" />\n            </div>\n          </div>\n        </Card>\n      </motion.div>\n\n      {/* Recently Analyzed Images Gallery */}\n      {recentAnalysesWithImages.length > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.3, delay: 0.1 }}\n        >\n          <h2 className=\"text-xl font-medium text-foreground mb-4\">Recently Analyzed Images</h2>\n          <Card className=\"p-6 shadow-md\">\n            <div className=\"flex gap-4 overflow-x-auto\">\n              {recentAnalysesWithImages.map((analysis, index) => (\n                <Link key={analysis.id} href={`/patients/${analysis.lesion?.patientId}`}>\n                  <motion.div\n                    initial={{ opacity: 0, scale: 0.8 }}\n                    animate={{ opacity: 1, scale: 1 }}\n                    transition={{ duration: 0.3, delay: 0.05 * index }}\n                    className=\"flex-shrink-0 cursor-pointer hover-elevate active-elevate-2 rounded-full transition-all duration-200\"\n                  >\n                    <div className=\"relative group\">\n                      <div className=\"h-20 w-20 rounded-full overflow-hidden border-2 border-border\">\n                        <img\n                          src={analysis.lesion?.imagePath}\n                          alt={`Analysis ${index + 1}`}\n                          className=\"h-full w-full object-cover\"\n                        />\n                      </div>\n                      <div className=\"absolute -bottom-1 -right-1 h-6 w-6 rounded-full bg-primary flex items-center justify-center text-xs text-primary-foreground font-medium border-2 border-background\">\n                        {analysis.confidence}\n                      </div>\n                    </div>\n                  </motion.div>\n                </Link>\n              ))}\n            </div>\n          </Card>\n        </motion.div>\n      )}\n\n      {/* Charts Section */}\n      <motion.div \n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.2 }}\n        className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\"\n      >\n        {/* Severity Distribution Donut Chart */}\n        <Card className=\"p-6 shadow-md\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-card-foreground\">Severity Distribution</h3>\n            <span className=\"text-xs text-muted-foreground italic\">Sample data</span>\n          </div>\n          <ResponsiveContainer width=\"100%\" height={250}>\n            <PieChart>\n              <Pie\n                data={severityData}\n                cx=\"50%\"\n                cy=\"50%\"\n                innerRadius={60}\n                outerRadius={90}\n                paddingAngle={5}\n                dataKey=\"value\"\n                animationBegin={0}\n                animationDuration={800}\n              >\n                {severityData.map((entry, index) => (\n                  <Cell key={`cell-${index}`} fill={entry.color} />\n                ))}\n              </Pie>\n              <Tooltip />\n              <Legend />\n            </PieChart>\n          </ResponsiveContainer>\n        </Card>\n\n        {/* Disease Type Frequency Bar Chart */}\n        <Card className=\"p-6 shadow-md\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-card-foreground\">Disease Type Frequency</h3>\n            <span className=\"text-xs text-muted-foreground italic\">Sample data</span>\n          </div>\n          <ResponsiveContainer width=\"100%\" height={250}>\n            <BarChart data={diseaseTypeData}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" />\n              <XAxis dataKey=\"name\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} />\n              <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'hsl(var(--card))', \n                  border: '1px solid hsl(var(--border))',\n                  borderRadius: '6px'\n                }}\n              />\n              <Bar dataKey=\"count\" radius={[8, 8, 0, 0]} animationDuration={800}>\n                {diseaseTypeData.map((entry, index) => (\n                  <Cell key={`cell-${index}`} fill={entry.color} />\n                ))}\n              </Bar>\n            </BarChart>\n          </ResponsiveContainer>\n        </Card>\n      </motion.div>\n\n      {/* Patient Improvement Trend Line Graph */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.3 }}\n      >\n        <Card className=\"p-6 shadow-md\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-medium text-card-foreground\">Patient Improvement Trend</h3>\n            <span className=\"text-xs text-muted-foreground italic\">Sample data</span>\n          </div>\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <RechartsLineChart data={improvementTrendData}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"hsl(var(--border))\" />\n              <XAxis dataKey=\"month\" stroke=\"hsl(var(--muted-foreground))\" />\n              <YAxis stroke=\"hsl(var(--muted-foreground))\" />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'hsl(var(--card))', \n                  border: '1px solid hsl(var(--border))',\n                  borderRadius: '6px'\n                }}\n              />\n              <Line \n                type=\"monotone\" \n                dataKey=\"improvement\" \n                stroke=\"hsl(var(--primary))\" \n                strokeWidth={3}\n                dot={{ fill: 'hsl(var(--primary))', r: 5 }}\n                activeDot={{ r: 7 }}\n                animationDuration={1000}\n                animationEasing=\"ease-in-out\"\n              />\n            </RechartsLineChart>\n          </ResponsiveContainer>\n        </Card>\n      </motion.div>\n\n      {/* Existing Patient Search and List */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.4 }}\n        className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\"\n      >\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search patients by name or ID...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-patients\"\n          />\n        </div>\n        <Link href=\"/patients/new\">\n          <Button data-testid=\"button-add-patient\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Add New Patient\n          </Button>\n        </Link>\n      </motion.div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.5 }}\n      >\n        <h2 className=\"text-xl font-medium text-foreground mb-4\">All Patients</h2>\n        {isLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[1, 2, 3].map((i) => (\n              <Card key={i} className=\"p-6 shadow-md\">\n                <div className=\"flex items-start gap-4\">\n                  <Skeleton className=\"h-12 w-12 rounded-full\" />\n                  <div className=\"flex-1 space-y-2\">\n                    <Skeleton className=\"h-5 w-32\" />\n                    <Skeleton className=\"h-4 w-24\" />\n                    <Skeleton className=\"h-4 w-full\" />\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        ) : filteredPatients && filteredPatients.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredPatients.map((patient) => (\n              <PatientCard key={patient.id} patient={patient} />\n            ))}\n          </div>\n        ) : (\n          <Card className=\"p-12 text-center shadow-md\">\n            <Users className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-card-foreground\">\n              {searchQuery ? \"No patients found\" : \"No patients yet\"}\n            </h3>\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              {searchQuery\n                ? \"Try adjusting your search\"\n                : \"Get started by adding your first patient\"}\n            </p>\n            {!searchQuery && (\n              <Link href=\"/patients/new\">\n                <Button className=\"mt-4\" data-testid=\"button-add-first-patient\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Patient\n                </Button>\n              </Link>\n            )}\n          </Card>\n        )}\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":15531},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/pages/analyses.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Activity, CheckCircle } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { format } from \"date-fns\";\nimport type { Analysis, Lesion, Patient } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useState } from \"react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype AnalysisWithRelations = Analysis & {\n  lesion?: Lesion & { patient?: Patient };\n};\n\nconst CLASSIFICATION_OPTIONS = [\"Benign\", \"Malignant\", \"Rash\", \"Infection\"];\n\nexport default function Analyses() {\n  const { toast } = useToast();\n  const [selectedGroundTruth, setSelectedGroundTruth] = useState<Record<string, string>>({});\n\n  const { data: analyses, isLoading } = useQuery<AnalysisWithRelations[]>({\n    queryKey: [\"/api/analyses\"],\n  });\n\n  const updateGroundTruthMutation = useMutation({\n    mutationFn: async ({ analysisId, groundTruthLabel }: { analysisId: string; groundTruthLabel: string }) => {\n      return await apiRequest(\"POST\", \"/api/fairness/update-ground-truth\", {\n        analysisId,\n        groundTruthLabel,\n        groundTruthSource: \"clinician_review\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/analyses\"] });\n      toast({\n        title: \"Ground truth recorded\",\n        description: \"Diagnosis has been verified for bias calibration.\",\n      });\n      setSelectedGroundTruth({});\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update ground truth\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getClassificationColor = (classification: string) => {\n    switch (classification.toLowerCase()) {\n      case \"benign\":\n        return \"success\";\n      case \"malignant\":\n        return \"destructive\";\n      case \"rash\":\n      case \"infection\":\n        return \"warning\";\n      default:\n        return \"secondary\";\n    }\n  };\n\n  const handleGroundTruthSubmit = (analysisId: string) => {\n    const groundTruthLabel = selectedGroundTruth[analysisId];\n    if (groundTruthLabel) {\n      updateGroundTruthMutation.mutate({ analysisId, groundTruthLabel });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Link href=\"/\">\n          <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-3xl font-medium text-foreground\">Analysis History</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            All AI-powered lesion classifications\n          </p>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"space-y-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"p-6\">\n              <Skeleton className=\"h-32 w-full\" />\n            </Card>\n          ))}\n        </div>\n      ) : analyses && analyses.length > 0 ? (\n        <div className=\"space-y-4\">\n          {analyses.map((analysis) => (\n            <Card key={analysis.id} className=\"p-6 hover-elevate active-elevate-2\">\n              <div className=\"flex items-start justify-between gap-6 flex-wrap\">\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-3 mb-3\">\n                    <h3 className=\"text-xl font-medium text-card-foreground\">\n                      {analysis.classification}\n                    </h3>\n                    <Badge\n                      variant={getClassificationColor(analysis.classification) as any}\n                      data-testid={`badge-classification-${analysis.id}`}\n                    >\n                      {analysis.confidence}% confidence\n                    </Badge>\n                  </div>\n                  {analysis.lesion?.patient && (\n                    <p className=\"text-sm text-muted-foreground\">\n                      Patient: <span className=\"font-medium\">{analysis.lesion.patient.name}</span> ({analysis.lesion.patient.patientId})\n                    </p>\n                  )}\n                  {analysis.lesion && (\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      Location: {analysis.lesion.location}\n                    </p>\n                  )}\n                  <p className=\"text-xs text-muted-foreground mt-3\">\n                    Analyzed {format(new Date(analysis.analyzedAt), \"MMM d, yyyy 'at' h:mm a\")}\n                  </p>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4 text-center\">\n                  <div>\n                    <p className=\"text-xs text-muted-foreground mb-1\">Benign</p>\n                    <p className=\"text-lg font-mono text-card-foreground\">{analysis.benignScore}%</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-muted-foreground mb-1\">Malignant</p>\n                    <p className=\"text-lg font-mono text-card-foreground\">{analysis.malignantScore}%</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-muted-foreground mb-1\">Rash</p>\n                    <p className=\"text-lg font-mono text-card-foreground\">{analysis.rashScore}%</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-muted-foreground mb-1\">Infection</p>\n                    <p className=\"text-lg font-mono text-card-foreground\">{analysis.infectionScore}%</p>\n                  </div>\n                </div>\n              </div>\n              {analysis.aiResponse && (\n                <div className=\"mt-4 pt-4 border-t border-border\">\n                  <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                    {analysis.aiResponse}\n                  </p>\n                </div>\n              )}\n              \n              <div className=\"mt-4 pt-4 border-t border-border\">\n                {analysis.groundTruthLabel ? (\n                  <div className=\"flex items-center gap-2\" data-testid={`ground-truth-verified-${analysis.id}`}>\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\n                    <span className=\"text-sm font-medium text-green-700 dark:text-green-400\">\n                      Ground Truth Verified: {analysis.groundTruthLabel}\n                    </span>\n                    <Badge variant=\"outline\" className=\"ml-2\">\n                      {analysis.groundTruthSource}\n                    </Badge>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\">\n                    <p className=\"text-sm font-medium text-muted-foreground\">\n                      Verify Diagnosis (for AI Fairness Calibration)\n                    </p>\n                    <div className=\"flex items-center gap-2\">\n                      <Select\n                        value={selectedGroundTruth[analysis.id] || \"\"}\n                        onValueChange={(value) =>\n                          setSelectedGroundTruth((prev) => ({ ...prev, [analysis.id]: value }))\n                        }\n                      >\n                        <SelectTrigger className=\"w-48\" data-testid={`select-ground-truth-${analysis.id}`}>\n                          <SelectValue placeholder=\"Select correct diagnosis\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {CLASSIFICATION_OPTIONS.map((option) => (\n                            <SelectItem key={option} value={option} data-testid={`option-${option}`}>\n                              {option}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <Button\n                        onClick={() => handleGroundTruthSubmit(analysis.id)}\n                        disabled={!selectedGroundTruth[analysis.id] || updateGroundTruthMutation.isPending}\n                        size=\"sm\"\n                        data-testid={`button-submit-ground-truth-${analysis.id}`}\n                      >\n                        {updateGroundTruthMutation.isPending ? \"Submitting...\" : \"Verify\"}\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card className=\"p-12 text-center\">\n          <Activity className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n          <h3 className=\"text-lg font-medium text-card-foreground\">No analyses yet</h3>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            Start by capturing and analyzing lesion images\n          </p>\n          <Link href=\"/capture\">\n            <Button className=\"mt-4\" data-testid=\"button-capture-lesion\">\n              <Activity className=\"h-4 w-4 mr-2\" />\n              Capture Lesion\n            </Button>\n          </Link>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":9368},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, integer, real, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Users/Clinicians table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  fullName: text(\"full_name\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  fullName: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Patients table\nexport const patients = pgTable(\"patients\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  patientId: text(\"patient_id\").notNull().unique(),\n  name: text(\"name\").notNull(),\n  dateOfBirth: text(\"date_of_birth\").notNull(),\n  gender: text(\"gender\").notNull(),\n  fitzpatrickType: text(\"fitzpatrick_type\"),\n  contactEmail: text(\"contact_email\"),\n  contactPhone: text(\"contact_phone\"),\n  accessToken: text(\"access_token\").notNull().unique(),\n  tokenLookupHash: text(\"token_lookup_hash\").notNull().unique(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertPatientSchema = createInsertSchema(patients).omit({\n  id: true,\n  accessToken: true,\n  tokenLookupHash: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertPatient = z.infer<typeof insertPatientSchema>;\nexport type Patient = typeof patients.$inferSelect;\n\n// Lesions table\nexport const lesions = pgTable(\"lesions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  patientId: varchar(\"patient_id\").notNull().references(() => patients.id),\n  imagePath: text(\"image_path\").notNull(),\n  location: text(\"location\").notNull(),\n  notes: text(\"notes\"),\n  capturedAt: timestamp(\"captured_at\").defaultNow().notNull(),\n});\n\nexport const insertLesionSchema = createInsertSchema(lesions).omit({\n  id: true,\n  capturedAt: true,\n});\n\nexport type InsertLesion = z.infer<typeof insertLesionSchema>;\nexport type Lesion = typeof lesions.$inferSelect;\n\n// AI Analysis results table\nexport const analyses = pgTable(\"analyses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  lesionId: varchar(\"lesion_id\").notNull().references(() => lesions.id),\n  classification: text(\"classification\").notNull(),\n  confidence: integer(\"confidence\").notNull(),\n  benignScore: integer(\"benign_score\").notNull(),\n  malignantScore: integer(\"malignant_score\").notNull(),\n  rashScore: integer(\"rash_score\").notNull(),\n  infectionScore: integer(\"infection_score\").notNull(),\n  aiResponse: text(\"ai_response\").notNull(),\n  groundTruthLabel: text(\"ground_truth_label\"),\n  groundTruthSource: text(\"ground_truth_source\"),\n  groundTruthRecordedAt: timestamp(\"ground_truth_recorded_at\"),\n  analyzedAt: timestamp(\"analyzed_at\").defaultNow().notNull(),\n});\n\nexport const insertAnalysisSchema = createInsertSchema(analyses).omit({\n  id: true,\n  analyzedAt: true,\n  groundTruthRecordedAt: true,\n});\n\nexport type InsertAnalysis = z.infer<typeof insertAnalysisSchema>;\nexport type Analysis = typeof analyses.$inferSelect;\n\n// Patient access tokens (OTP for patient portal)\nexport const patientTokens = pgTable(\"patient_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  patientId: varchar(\"patient_id\").notNull().references(() => patients.id),\n  token: text(\"token\").notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertPatientTokenSchema = createInsertSchema(patientTokens).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertPatientToken = z.infer<typeof insertPatientTokenSchema>;\nexport type PatientToken = typeof patientTokens.$inferSelect;\n\n// Patient portal access audit log\nexport const portalAccessLogs = pgTable(\"portal_access_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  attemptedToken: text(\"attempted_token\"),\n  attemptedPatientId: text(\"attempted_patient_id\"),\n  attemptedName: text(\"attempted_name\"),\n  success: boolean(\"success\").notNull(),\n  patientId: varchar(\"patient_id\").references(() => patients.id),\n  failureReason: text(\"failure_reason\"),\n  ipAddress: text(\"ip_address\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertPortalAccessLogSchema = createInsertSchema(portalAccessLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertPortalAccessLog = z.infer<typeof insertPortalAccessLogSchema>;\nexport type PortalAccessLog = typeof portalAccessLogs.$inferSelect;\n\n// Fairness audit runs table\nexport const fairnessAuditRuns = pgTable(\"fairness_audit_runs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  totalSamples: integer(\"total_samples\").notNull(),\n  samplesWithGroundTruth: integer(\"samples_with_ground_truth\").notNull(),\n  overallDisparityScore: real(\"overall_disparity_score\").notNull(),\n  demographicParityGap: real(\"demographic_parity_gap\").notNull(),\n  equalOpportunityGap: real(\"equal_opportunity_gap\").notNull(),\n  calibrationGap: real(\"calibration_gap\").notNull(),\n  parityAlert: boolean(\"parity_alert\").default(false).notNull(),\n  opportunityAlert: boolean(\"opportunity_alert\").default(false).notNull(),\n  calibrationAlert: boolean(\"calibration_alert\").default(false).notNull(),\n  runAt: timestamp(\"run_at\").defaultNow().notNull(),\n});\n\nexport const insertFairnessAuditRunSchema = createInsertSchema(fairnessAuditRuns).omit({\n  id: true,\n  runAt: true,\n});\n\nexport type InsertFairnessAuditRun = z.infer<typeof insertFairnessAuditRunSchema>;\nexport type FairnessAuditRun = typeof fairnessAuditRuns.$inferSelect;\n\n// Fairness metrics table - per skin tone statistics\nexport const fairnessMetrics = pgTable(\"fairness_metrics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  auditRunId: varchar(\"audit_run_id\").notNull().references(() => fairnessAuditRuns.id),\n  fitzpatrickType: text(\"fitzpatrick_type\").notNull(),\n  totalPredictions: integer(\"total_predictions\").notNull(),\n  positivePredictions: integer(\"positive_predictions\").notNull(),\n  truePositives: integer(\"true_positives\").notNull(),\n  falsePositives: integer(\"false_positives\").notNull(),\n  trueNegatives: integer(\"true_negatives\").notNull(),\n  falseNegatives: integer(\"false_negatives\").notNull(),\n  positiveRate: real(\"positive_rate\").notNull(),\n  truePositiveRate: real(\"true_positive_rate\").notNull(),\n  falsePositiveRate: real(\"false_positive_rate\").notNull(),\n  precision: real(\"precision\").notNull(),\n  recall: real(\"recall\").notNull(),\n  f1Score: real(\"f1_score\").notNull(),\n  brierScore: real(\"brier_score\").notNull(),\n  averageConfidence: real(\"average_confidence\").notNull(),\n  accuracyAtConfidence: real(\"accuracy_at_confidence\").notNull(),\n});\n\nexport const insertFairnessMetricSchema = createInsertSchema(fairnessMetrics).omit({\n  id: true,\n});\n\nexport type InsertFairnessMetric = z.infer<typeof insertFairnessMetricSchema>;\nexport type FairnessMetric = typeof fairnessMetrics.$inferSelect;\n","size_bytes":7415},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/pages/capture-lesion.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ImageUpload } from \"@/components/image-upload\";\nimport { AnalysisResultCard } from \"@/components/analysis-result-card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { insertLesionSchema } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft, Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { z } from \"zod\";\nimport type { Patient, Analysis } from \"@shared/schema\";\n\nconst captureFormSchema = insertLesionSchema.extend({\n  image: z.any(),\n});\n\ntype CaptureFormData = z.infer<typeof captureFormSchema>;\n\nexport default function CaptureLesion() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [selectedImage, setSelectedImage] = useState<File | null>(null);\n  const [analysis, setAnalysis] = useState<Analysis | null>(null);\n\n  const urlParams = new URLSearchParams(window.location.search);\n  const preselectedPatientId = urlParams.get(\"patientId\");\n\n  const { data: patients } = useQuery<Patient[]>({\n    queryKey: [\"/api/patients\"],\n  });\n\n  const form = useForm<CaptureFormData>({\n    resolver: zodResolver(captureFormSchema),\n    defaultValues: {\n      patientId: preselectedPatientId || \"\",\n      imagePath: \"\",\n      location: \"\",\n      notes: undefined,\n    },\n  });\n\n  const analyzeLesion = useMutation({\n    mutationFn: async (data: FormData) => {\n      const response = await fetch(\"/api/analyze-lesion\", {\n        method: \"POST\",\n        body: data,\n      });\n      if (!response.ok) {\n        throw new Error(await response.text());\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setAnalysis(data.analysis);\n      queryClient.invalidateQueries({ queryKey: [\"/api/patients\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      toast({\n        title: \"Analysis complete\",\n        description: \"AI analysis has been completed successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Analysis failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = async (data: CaptureFormData) => {\n    if (!selectedImage) {\n      toast({\n        title: \"No image selected\",\n        description: \"Please upload a lesion image.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append(\"image\", selectedImage);\n    formData.append(\"patientId\", data.patientId);\n    formData.append(\"location\", data.location);\n    if (data.notes) {\n      formData.append(\"notes\", data.notes);\n    }\n\n    analyzeLesion.mutate(formData);\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto space-y-6\">\n      <div className=\"flex items-center gap-4\">\n        <Link href=\"/\">\n          <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-3xl font-medium text-foreground\">Capture & Analyze Lesion</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Upload lesion image for AI-powered classification\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div>\n          <Card className=\"p-6\">\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"patientId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Patient</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        defaultValue={field.value}\n                        disabled={!!preselectedPatientId}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-patient\">\n                            <SelectValue placeholder=\"Select patient\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {patients?.map((patient) => (\n                            <SelectItem key={patient.id} value={patient.id}>\n                              {patient.name} ({patient.patientId})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"location\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Lesion Location</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"e.g., Left forearm, Upper back\"\n                          {...field}\n                          data-testid=\"input-location\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Clinical Notes (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Add any relevant clinical observations...\"\n                          className=\"resize-none\"\n                          rows={4}\n                          {...field}\n                          data-testid=\"input-notes\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div>\n                  <FormLabel>Lesion Image</FormLabel>\n                  <div className=\"mt-2\">\n                    <ImageUpload\n                      onImageSelect={setSelectedImage}\n                      value={selectedImage}\n                      disabled={analyzeLesion.isPending}\n                    />\n                  </div>\n                </div>\n\n                <Button\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={analyzeLesion.isPending || !selectedImage}\n                  data-testid=\"button-analyze\"\n                >\n                  {analyzeLesion.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Analyzing...\n                    </>\n                  ) : (\n                    \"Analyze Lesion\"\n                  )}\n                </Button>\n              </form>\n            </Form>\n          </Card>\n        </div>\n\n        <div>\n          {analyzeLesion.isPending ? (\n            <Card className=\"p-6\">\n              <div className=\"flex flex-col items-center justify-center py-12\">\n                <Loader2 className=\"h-12 w-12 animate-spin text-primary mb-4\" />\n                <h3 className=\"text-lg font-medium text-card-foreground\">\n                  Analyzing lesion...\n                </h3>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  AI is processing the image\n                </p>\n              </div>\n            </Card>\n          ) : analysis ? (\n            <div className=\"space-y-4\">\n              <AnalysisResultCard analysis={analysis} />\n              <div className=\"flex gap-4\">\n                <Button\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                  onClick={() => {\n                    setAnalysis(null);\n                    setSelectedImage(null);\n                    form.reset();\n                  }}\n                  data-testid=\"button-analyze-another\"\n                >\n                  Analyze Another\n                </Button>\n                <Button\n                  className=\"flex-1\"\n                  onClick={() => navigate(\"/\")}\n                  data-testid=\"button-done\"\n                >\n                  Done\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <Card className=\"p-6\">\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                <div className=\"h-16 w-16 rounded-full bg-muted flex items-center justify-center mb-4\">\n                  <Loader2 className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-card-foreground\">\n                  Ready to analyze\n                </h3>\n                <p className=\"text-sm text-muted-foreground mt-2 max-w-sm\">\n                  Upload a lesion image and click \"Analyze Lesion\" to get AI-powered\n                  classification results\n                </p>\n              </div>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9858},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport Dashboard from \"@/pages/dashboard\";\nimport NewPatient from \"@/pages/new-patient\";\nimport PatientDetail from \"@/pages/patient-detail\";\nimport CaptureLesion from \"@/pages/capture-lesion\";\nimport Analyses from \"@/pages/analyses\";\nimport ProgressTracker from \"@/pages/progress-tracker\";\nimport Reports from \"@/pages/reports\";\nimport PatientPortal from \"@/pages/patient-portal\";\nimport FairnessCalibration from \"@/pages/fairness-calibration\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/patients/new\" component={NewPatient} />\n      <Route path=\"/patients/:id\" component={PatientDetail} />\n      <Route path=\"/capture\" component={CaptureLesion} />\n      <Route path=\"/analyses\" component={Analyses} />\n      <Route path=\"/progress\" component={ProgressTracker} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/patient-portal\" component={PatientPortal} />\n      <Route path=\"/fairness\" component={FairnessCalibration} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nexport default function App() {\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"light\">\n        <TooltipProvider>\n          <SidebarProvider style={style as React.CSSProperties}>\n            <div className=\"flex h-screen w-full\">\n              <AppSidebar />\n              <div className=\"flex flex-col flex-1 overflow-hidden\">\n                <header className=\"flex items-center justify-between p-4 border-b border-border bg-background\">\n                  <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                  <ThemeToggle />\n                </header>\n                <main className=\"flex-1 overflow-auto p-8 bg-background\">\n                  <Router />\n                </main>\n              </div>\n            </div>\n          </SidebarProvider>\n          <Toaster />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n","size_bytes":2636},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 210 6% 12%;\n  --border: 210 3% 88%;\n  --card: 0 0% 98%;\n  --card-foreground: 210 6% 12%;\n  --card-border: 210 3% 94%;\n  --sidebar: 210 4% 96%;\n  --sidebar-foreground: 210 6% 12%;\n  --sidebar-border: 210 3% 92%;\n  --sidebar-primary: 195 84% 38%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 210 6% 92%;\n  --sidebar-accent-foreground: 210 6% 12%;\n  --sidebar-ring: 195 84% 38%;\n  --popover: 210 5% 94%;\n  --popover-foreground: 210 6% 12%;\n  --popover-border: 210 4% 90%;\n  --primary: 186 80% 42%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 210 8% 90%;\n  --secondary-foreground: 210 6% 12%;\n  --muted: 210 7% 92%;\n  --muted-foreground: 210 6% 40%;\n  --accent: 210 10% 93%;\n  --accent-foreground: 210 6% 12%;\n  --destructive: 0 72% 51%;\n  --destructive-foreground: 0 0% 100%;\n  --success: 142 71% 45%;\n  --success-foreground: 0 0% 100%;\n  --warning: 38 92% 50%;\n  --warning-foreground: 0 0% 100%;\n  --input: 210 6% 70%;\n  --ring: 186 80% 42%;\n  --chart-1: 186 80% 42%;\n  --chart-2: 142 71% 45%;\n  --chart-3: 38 92% 50%;\n  --chart-4: 0 72% 51%;\n  --chart-5: 210 65% 40%;\n  --font-sans: Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Roboto Mono, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 6% 12% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 6% 12% / 0.03);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 6% 12% / 0.04), 0px 1px 2px -1px hsl(210 6% 12% / 0.06);\n  --shadow: 0px 2px 0px 0px hsl(210 6% 12% / 0.04), 0px 1px 2px -1px hsl(210 6% 12% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(210 6% 12% / 0.05), 0px 2px 4px -1px hsl(210 6% 12% / 0.08);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 6% 12% / 0.06), 0px 4px 6px -1px hsl(210 6% 12% / 0.10);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 6% 12% / 0.08), 0px 8px 10px -1px hsl(210 6% 12% / 0.12);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 6% 12% / 0.10);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 210 5% 8%;\n  --foreground: 210 3% 96%;\n  --border: 210 4% 16%;\n  --card: 210 5% 10%;\n  --card-foreground: 210 3% 96%;\n  --card-border: 210 4% 13%;\n  --sidebar: 210 5% 12%;\n  --sidebar-foreground: 210 3% 96%;\n  --sidebar-border: 210 4% 15%;\n  --sidebar-primary: 195 84% 45%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 210 6% 16%;\n  --sidebar-accent-foreground: 210 3% 96%;\n  --sidebar-ring: 195 84% 45%;\n  --popover: 210 5% 14%;\n  --popover-foreground: 210 3% 96%;\n  --popover-border: 210 4% 18%;\n  --primary: 186 80% 50%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 210 8% 18%;\n  --secondary-foreground: 210 3% 96%;\n  --muted: 210 7% 16%;\n  --muted-foreground: 210 4% 65%;\n  --accent: 210 10% 15%;\n  --accent-foreground: 210 3% 96%;\n  --destructive: 0 72% 51%;\n  --destructive-foreground: 0 0% 100%;\n  --success: 142 71% 45%;\n  --success-foreground: 0 0% 100%;\n  --warning: 38 92% 50%;\n  --warning-foreground: 0 0% 100%;\n  --input: 210 6% 30%;\n  --ring: 186 80% 50%;\n  --chart-1: 186 80% 65%;\n  --chart-2: 142 71% 60%;\n  --chart-3: 38 92% 65%;\n  --chart-4: 0 72% 60%;\n  --chart-5: 210 65% 68%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.15);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.18);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.20), 0px 1px 2px -1px hsl(0 0% 0% / 0.25);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.20), 0px 1px 2px -1px hsl(0 0% 0% / 0.25);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.25), 0px 2px 4px -1px hsl(0 0% 0% / 0.30);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.28), 0px 4px 6px -1px hsl(0 0% 0% / 0.35);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.32), 0px 8px 10px -1px hsl(0 0% 0% / 0.40);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.35);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","size_bytes":10899},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport { promises as fs } from \"fs\";\nimport path from \"path\";\nimport PDFDocument from \"pdfkit\";\nimport { storage } from \"./storage\";\nimport { analyzeLesionImage } from \"./gemini\";\nimport { insertPatientSchema, insertLesionSchema, insertAnalysisSchema } from \"@shared/schema\";\nimport { randomBytes } from \"crypto\";\nimport {\n  calculateFairnessMetricsPerGroup,\n  calculateDisparityMetrics,\n  type AnalysisWithPatient,\n} from \"./fairness\";\nimport { generateAccessToken, hashAccessToken, createTokenLookupHash, verifyAccessToken, isValidTokenFormat } from \"./token-utils\";\n\n// Configure multer for image uploads\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  limits: { fileSize: 10 * 1024 * 1024 }, // 10MB limit\n  fileFilter: (_req, file, cb) => {\n    if (file.mimetype.startsWith(\"image/\")) {\n      cb(null, true);\n    } else {\n      cb(new Error(\"Only image files are allowed\"));\n    }\n  },\n});\n\n// Ensure uploads directory exists\nconst uploadsDir = path.join(process.cwd(), \"uploads\");\nfs.mkdir(uploadsDir, { recursive: true }).catch(console.error);\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Patient routes\n  app.get(\"/api/patients\", async (_req, res) => {\n    try {\n      const patients = await storage.getAllPatients();\n      res.json(patients);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  app.get(\"/api/patients/:id\", async (req, res) => {\n    try {\n      const patient = await storage.getPatient(req.params.id);\n      if (!patient) {\n        return res.status(404).send(\"Patient not found\");\n      }\n      res.json(patient);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  app.post(\"/api/patients\", async (req, res) => {\n    try {\n      const validatedData = insertPatientSchema.parse(req.body);\n\n      // Check if patient ID already exists\n      const existing = await storage.getPatientByPatientId(validatedData.patientId);\n      if (existing) {\n        return res.status(400).send(\"Patient ID already exists\");\n      }\n\n      // Generate and hash access token\n      const plainToken = generateAccessToken();\n      const hashedToken = hashAccessToken(plainToken);\n      const lookupHash = createTokenLookupHash(plainToken);\n\n      const patient = await storage.createPatient(validatedData, hashedToken, lookupHash);\n      \n      // Return patient with plaintext token (one-time reveal for doctor)\n      res.json({ ...patient, plaintextToken: plainToken });\n    } catch (error: any) {\n      res.status(400).send(error.message);\n    }\n  });\n\n  // Lesion routes\n  app.get(\"/api/patients/:patientId/lesions\", async (req, res) => {\n    try {\n      const lesions = await storage.getLesionsByPatientId(req.params.patientId);\n\n      // Attach analysis data to each lesion\n      const lesionsWithAnalysis = await Promise.all(\n        lesions.map(async (lesion) => {\n          const analysis = await storage.getAnalysisByLesionId(lesion.id);\n          return { ...lesion, analysis };\n        })\n      );\n\n      res.json(lesionsWithAnalysis);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Analyze lesion (upload + AI analysis)\n  app.post(\"/api/analyze-lesion\", upload.single(\"image\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).send(\"No image file provided\");\n      }\n\n      const { patientId, location, notes } = req.body;\n\n      if (!patientId || !location) {\n        return res.status(400).send(\"Patient ID and location are required\");\n      }\n\n      // Verify patient exists\n      const patient = await storage.getPatient(patientId);\n      if (!patient) {\n        return res.status(404).send(\"Patient not found\");\n      }\n\n      // Save image to disk with safe filename (no leading slash)\n      const safeFilename = `${Date.now()}-${req.file.originalname.replace(/[^a-zA-Z0-9.-]/g, \"_\")}`;\n      const filepath = path.join(uploadsDir, safeFilename);\n      await fs.writeFile(filepath, req.file.buffer);\n\n      // Convert image to base64 for OpenAI\n      const base64Image = req.file.buffer.toString(\"base64\");\n\n      // Analyze with OpenAI\n      const analysisResult = await analyzeLesionImage(base64Image);\n\n      // Validate and create lesion record\n      const lesionData = insertLesionSchema.parse({\n        patientId,\n        imagePath: `/uploads/${safeFilename}`,\n        location,\n        notes: notes || null,\n      });\n\n      const lesion = await storage.createLesion(lesionData);\n\n      // Validate and create analysis record\n      const analysisData = insertAnalysisSchema.parse({\n        lesionId: lesion.id,\n        classification: analysisResult.classification,\n        confidence: analysisResult.confidence,\n        benignScore: analysisResult.benignScore,\n        malignantScore: analysisResult.malignantScore,\n        rashScore: analysisResult.rashScore,\n        infectionScore: analysisResult.infectionScore,\n        aiResponse: analysisResult.reasoning,\n      });\n\n      const analysis = await storage.createAnalysis(analysisData);\n\n      res.json({ lesion, analysis });\n    } catch (error: any) {\n      console.error(\"Analysis error:\", error);\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Analysis routes\n  app.get(\"/api/analyses\", async (_req, res) => {\n    try {\n      const analyses = await storage.getAllAnalyses();\n\n      // Attach lesion and patient data\n      const analysesWithData = await Promise.all(\n        analyses.map(async (analysis) => {\n          const lesion = await storage.getLesion(analysis.lesionId);\n          if (lesion) {\n            const patient = await storage.getPatient(lesion.patientId);\n            return { ...analysis, lesion: { ...lesion, patient } };\n          }\n          return analysis;\n        })\n      );\n\n      res.json(analysesWithData);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Stats route\n  app.get(\"/api/stats\", async (_req, res) => {\n    try {\n      const stats = await storage.getStats();\n      res.json(stats);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Fairness/Bias calibration routes\n  app.post(\"/api/fairness/update-ground-truth\", async (req, res) => {\n    try {\n      const { analysisId, groundTruthLabel, groundTruthSource } = req.body;\n\n      if (!analysisId || !groundTruthLabel || !groundTruthSource) {\n        return res.status(400).send(\"Analysis ID, ground truth label, and source are required\");\n      }\n\n      const validClassifications = [\"Benign\", \"Malignant\", \"Rash\", \"Infection\"];\n      if (!validClassifications.includes(groundTruthLabel)) {\n        return res.status(400).send(\"Invalid ground truth label. Must be one of: Benign, Malignant, Rash, Infection\");\n      }\n\n      const analysis = await storage.getAnalysis(analysisId);\n      if (!analysis) {\n        return res.status(404).send(\"Analysis not found\");\n      }\n\n      const updatedAnalysis = await storage.updateAnalysisGroundTruth(\n        analysisId,\n        groundTruthLabel,\n        groundTruthSource\n      );\n\n      res.json(updatedAnalysis);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  app.post(\"/api/fairness/calculate\", async (req, res) => {\n    try {\n      const { daysBack = 30 } = req.body;\n\n      const endDate = new Date();\n      const startDate = new Date();\n      startDate.setDate(startDate.getDate() - daysBack);\n\n      const totalSamples = await storage.getAnalysesCountInDateRange(startDate, endDate);\n      const analysesData = await storage.getAnalysesWithGroundTruth(startDate, endDate);\n\n      if (analysesData.length === 0) {\n        return res.status(400).send(\"No analyses with ground truth labels found in the specified date range\");\n      }\n\n      const analysesWithPatients: AnalysisWithPatient[] = analysesData.map((item) => ({\n        analysis: item.analysis,\n        patient: item.patient,\n      }));\n\n      const metricsPerGroup = calculateFairnessMetricsPerGroup(analysesWithPatients);\n      const disparityMetrics = calculateDisparityMetrics(metricsPerGroup);\n\n      const samplesWithGroundTruth = analysesData.length;\n\n      const auditRun = await storage.createFairnessAuditRun({\n        startDate,\n        endDate,\n        totalSamples,\n        samplesWithGroundTruth,\n        overallDisparityScore: disparityMetrics.overallDisparityScore,\n        demographicParityGap: disparityMetrics.demographicParityGap,\n        equalOpportunityGap: disparityMetrics.equalOpportunityGap,\n        calibrationGap: disparityMetrics.calibrationGap,\n        parityAlert: disparityMetrics.parityAlert,\n        opportunityAlert: disparityMetrics.opportunityAlert,\n        calibrationAlert: disparityMetrics.calibrationAlert,\n      });\n\n      const metricsToInsert = metricsPerGroup.map((metric) => ({\n        auditRunId: auditRun.id,\n        fitzpatrickType: metric.fitzpatrickType,\n        totalPredictions: metric.totalPredictions,\n        positivePredictions: metric.positivePredictions,\n        truePositives: metric.truePositives,\n        falsePositives: metric.falsePositives,\n        trueNegatives: metric.trueNegatives,\n        falseNegatives: metric.falseNegatives,\n        positiveRate: metric.positiveRate,\n        truePositiveRate: metric.truePositiveRate,\n        falsePositiveRate: metric.falsePositiveRate,\n        precision: metric.precision,\n        recall: metric.recall,\n        f1Score: metric.f1Score,\n        brierScore: metric.brierScore,\n        averageConfidence: metric.averageConfidence,\n        accuracyAtConfidence: metric.accuracyAtConfidence,\n      }));\n\n      await storage.createFairnessMetrics(metricsToInsert);\n\n      res.json({ auditRun, metrics: metricsPerGroup, disparity: disparityMetrics });\n    } catch (error: any) {\n      console.error(\"Fairness calculation error:\", error);\n      res.status(500).send(error.message);\n    }\n  });\n\n  app.get(\"/api/fairness/audit-runs\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 10;\n      const auditRuns = await storage.getFairnessAuditRuns(limit);\n      res.json(auditRuns);\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  app.get(\"/api/fairness/audit-runs/:id\", async (req, res) => {\n    try {\n      const auditRuns = await storage.getFairnessAuditRuns(1000);\n      const auditRun = auditRuns.find((run) => run.id === req.params.id);\n\n      if (!auditRun) {\n        return res.status(404).send(\"Audit run not found\");\n      }\n\n      const metrics = await storage.getFairnessMetricsByAuditRunId(auditRun.id);\n\n      res.json({ auditRun, metrics });\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  app.get(\"/api/fairness/alerts\", async (req, res) => {\n    try {\n      const latestAuditRun = await storage.getLatestFairnessAuditRun();\n\n      if (!latestAuditRun) {\n        return res.json({ alerts: [] });\n      }\n\n      const alerts = [];\n\n      if (latestAuditRun.parityAlert) {\n        alerts.push({\n          type: \"demographic_parity\",\n          severity: \"warning\",\n          message: `Demographic parity gap of ${(latestAuditRun.demographicParityGap * 100).toFixed(1)}% detected across skin tones`,\n          gap: latestAuditRun.demographicParityGap,\n        });\n      }\n\n      if (latestAuditRun.opportunityAlert) {\n        alerts.push({\n          type: \"equal_opportunity\",\n          severity: \"warning\",\n          message: `Equal opportunity gap of ${(latestAuditRun.equalOpportunityGap * 100).toFixed(1)}% detected across skin tones`,\n          gap: latestAuditRun.equalOpportunityGap,\n        });\n      }\n\n      if (latestAuditRun.calibrationAlert) {\n        alerts.push({\n          type: \"calibration\",\n          severity: \"warning\",\n          message: `Calibration gap of ${(latestAuditRun.calibrationGap * 100).toFixed(1)}% detected across skin tones`,\n          gap: latestAuditRun.calibrationGap,\n        });\n      }\n\n      res.json({ alerts, auditRun: latestAuditRun });\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Patient portal routes - Secure two-step verification\n  // Step 1: Verify access token exists\n  app.post(\"/api/patient-portal/verify-token\", async (req, res) => {\n    try {\n      const { token } = req.body;\n      const ipAddress = req.ip || req.socket.remoteAddress;\n\n      // Rate limiting: Check recent attempts from this IP\n      const recentAttempts = await storage.getRecentPortalAccessAttempts(15, ipAddress);\n      if (recentAttempts > 10) {\n        await storage.createPortalAccessLog({\n          attemptedToken: token?.substring(0, 4) + \"***\",\n          success: false,\n          failureReason: \"rate_limit_exceeded\",\n          ipAddress,\n          attemptedPatientId: null,\n          attemptedName: null,\n          patientId: null,\n        });\n        return res.status(429).send(\"Too many attempts. Please try again later.\");\n      }\n\n      if (!token || !isValidTokenFormat(token)) {\n        await storage.createPortalAccessLog({\n          attemptedToken: token?.substring(0, 4) + \"***\",\n          success: false,\n          failureReason: \"invalid_token_format\",\n          ipAddress,\n          attemptedPatientId: null,\n          attemptedName: null,\n          patientId: null,\n        });\n        return res.status(400).send(\"Invalid token format\");\n      }\n\n      // Create lookup hash to find patient, then verify with bcrypt\n      const lookupHash = createTokenLookupHash(token);\n      const patient = await storage.getPatientByTokenLookupHash(lookupHash);\n\n      if (!patient) {\n        await storage.createPortalAccessLog({\n          attemptedToken: token.substring(0, 4) + \"***\",\n          success: false,\n          failureReason: \"token_not_found\",\n          ipAddress,\n          attemptedPatientId: null,\n          attemptedName: null,\n          patientId: null,\n        });\n        return res.status(401).send(\"Invalid access token\");\n      }\n\n      // Verify the token using bcrypt for security\n      if (!verifyAccessToken(token, patient.accessToken)) {\n        await storage.createPortalAccessLog({\n          attemptedToken: token.substring(0, 4) + \"***\",\n          success: false,\n          failureReason: \"token_verification_failed\",\n          ipAddress,\n          attemptedPatientId: null,\n          attemptedName: null,\n          patientId: patient.id,\n        });\n        return res.status(401).send(\"Invalid access token\");\n      }\n\n      // Token is valid - return minimal info for step 2\n      res.json({ \n        tokenValid: true,\n        message: \"Token verified. Please provide your details to continue.\"\n      });\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Step 2: Verify patient identity (token + patient ID + name + DOB)\n  app.post(\"/api/patient-portal/verify-patient\", async (req, res) => {\n    try {\n      const { token, patientId, name, dateOfBirth } = req.body;\n      const ipAddress = req.ip || req.socket.remoteAddress;\n\n      if (!token || !patientId || !name || !dateOfBirth) {\n        return res.status(400).send(\"All fields are required\");\n      }\n\n      // Find patient by lookup hash, then verify with bcrypt\n      const lookupHash = createTokenLookupHash(token);\n      const patient = await storage.getPatientByTokenLookupHash(lookupHash);\n\n      if (!patient || !verifyAccessToken(token, patient.accessToken)) {\n        await storage.createPortalAccessLog({\n          attemptedToken: token.substring(0, 4) + \"***\",\n          attemptedPatientId: patientId,\n          attemptedName: name,\n          success: false,\n          failureReason: \"token_not_found\",\n          ipAddress,\n          patientId: patient?.id || null,\n        });\n        return res.status(401).send(\"Access denied. Please check your information.\");\n      }\n\n      // Verify all identity factors (case-insensitive name comparison)\n      const nameMatch = patient.name.toLowerCase() === name.toLowerCase();\n      const idMatch = patient.patientId === patientId;\n      const dobMatch = patient.dateOfBirth === dateOfBirth;\n\n      if (!nameMatch || !idMatch || !dobMatch) {\n        await storage.createPortalAccessLog({\n          attemptedToken: token.substring(0, 4) + \"***\",\n          attemptedPatientId: patientId,\n          attemptedName: name,\n          success: false,\n          failureReason: \"identity_mismatch\",\n          ipAddress,\n          patientId: patient.id,\n        });\n        return res.status(401).send(\"Patient information does not match. Please verify your details.\");\n      }\n\n      // Success - log access and return session token\n      await storage.createPortalAccessLog({\n        attemptedToken: token.substring(0, 4) + \"***\",\n        attemptedPatientId: patientId,\n        attemptedName: name,\n        success: true,\n        failureReason: null,\n        ipAddress,\n        patientId: patient.id,\n      });\n\n      // Return verified token for subsequent data requests\n      res.json({ \n        verified: true,\n        accessToken: token,\n        message: \"Identity verified successfully\"\n      });\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Get patient portal data (after successful verification)\n  app.get(\"/api/patient-portal/data/:token\", async (req, res) => {\n    try {\n      const { token } = req.params;\n\n      if (!token || !isValidTokenFormat(token)) {\n        return res.status(400).send(\"Invalid token format\");\n      }\n\n      // Find patient by lookup hash, then verify with bcrypt\n      const lookupHash = createTokenLookupHash(token);\n      const patient = await storage.getPatientByTokenLookupHash(lookupHash);\n\n      if (!patient || !verifyAccessToken(token, patient.accessToken)) {\n        return res.status(401).send(\"Invalid access token\");\n      }\n\n      // Fetch patient data with scoped projection (only necessary fields)\n      const lesions = await storage.getLesionsByPatientId(patient.id);\n      const lesionsWithAnalysis = await Promise.all(\n        lesions.map(async (lesion) => {\n          const analysis = await storage.getAnalysisByLesionId(lesion.id);\n          return { ...lesion, analysis };\n        })\n      );\n\n      // Return scoped data (exclude sensitive fields like accessToken)\n      const { accessToken, ...patientData } = patient;\n      res.json({ \n        patient: patientData, \n        lesions: lesionsWithAnalysis \n      });\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Regenerate patient access token (for lost tokens or security resets)\n  app.post(\"/api/patients/:patientId/regenerate-token\", async (req, res) => {\n    try {\n      const patient = await storage.getPatient(req.params.patientId);\n      if (!patient) {\n        return res.status(404).send(\"Patient not found\");\n      }\n\n      // Generate and hash new access token\n      const plainToken = generateAccessToken();\n      const hashedToken = hashAccessToken(plainToken);\n      const lookupHash = createTokenLookupHash(plainToken);\n\n      // Update patient with new token\n      const updatedPatient = await storage.updatePatient(patient.id, {\n        accessToken: hashedToken,\n        tokenLookupHash: lookupHash,\n      });\n\n      // Return patient with plaintext token (one-time reveal)\n      res.json({ ...updatedPatient, plaintextToken: plainToken });\n    } catch (error: any) {\n      res.status(500).send(error.message);\n    }\n  });\n\n  // Report generation (PDF)\n  app.post(\"/api/reports/generate/:patientId\", async (req, res) => {\n    try {\n      const patient = await storage.getPatient(req.params.patientId);\n      if (!patient) {\n        return res.status(404).send(\"Patient not found\");\n      }\n\n      const lesions = await storage.getLesionsByPatientId(patient.id);\n      const lesionsWithAnalysis = await Promise.all(\n        lesions.map(async (lesion) => {\n          const analysis = await storage.getAnalysisByLesionId(lesion.id);\n          return { ...lesion, analysis };\n        })\n      );\n\n      // Create PDF document\n      const doc = new PDFDocument({ margin: 50, size: \"A4\" });\n\n      // Set response headers\n      res.setHeader(\"Content-Type\", \"application/pdf\");\n      res.setHeader(\n        \"Content-Disposition\",\n        `attachment; filename=patient-report-${patient.patientId}.pdf`\n      );\n\n      // Pipe the PDF to the response\n      doc.pipe(res);\n\n      // Handle completion\n      doc.on(\"end\", () => {\n        res.end();\n      });\n\n      // Add header\n      doc.fontSize(24).fillColor(\"#0891b2\").text(\"SAGAlyze\", { align: \"center\" });\n      doc.fontSize(12).fillColor(\"#64748b\").text(\"Smart AI Dermatology Assistant\", { align: \"center\" });\n      doc.moveDown(2);\n\n      // Patient Information Section\n      doc.fontSize(18).fillColor(\"#0f172a\").text(\"Patient Information\");\n      doc.moveDown(0.5);\n      doc.fontSize(12).fillColor(\"#334155\");\n      doc.text(`Name: ${patient.name}`);\n      doc.text(`Patient ID: ${patient.patientId}`);\n      doc.text(`Date of Birth: ${new Date(patient.dateOfBirth).toLocaleDateString()}`);\n      doc.text(`Gender: ${patient.gender}`);\n      if (patient.fitzpatrickType) {\n        doc.text(`Fitzpatrick Skin Type: ${patient.fitzpatrickType}`);\n      }\n      if (patient.contactEmail) {\n        doc.text(`Email: ${patient.contactEmail}`);\n      }\n      if (patient.contactPhone) {\n        doc.text(`Phone: ${patient.contactPhone}`);\n      }\n      doc.moveDown(2);\n\n      // Lesion Summary Section\n      doc.fontSize(18).fillColor(\"#0f172a\").text(\"Lesion Summary\");\n      doc.moveDown(0.5);\n      doc.fontSize(12).fillColor(\"#334155\");\n      \n      if (lesions.length === 0) {\n        doc.text(\"No lesions have been analyzed for this patient yet.\");\n      } else {\n        doc.text(`Total Lesions Analyzed: ${lesions.length}`);\n        doc.moveDown(1);\n\n        // Individual Lesions\n        lesionsWithAnalysis.forEach((lesion, i) => {\n          // Check if we need a new page\n          if (doc.y > 650) {\n            doc.addPage();\n          }\n\n          doc.fontSize(14).fillColor(\"#0f172a\").text(`Lesion ${i + 1}`);\n          doc.fontSize(12).fillColor(\"#334155\");\n          doc.text(`Location: ${lesion.location}`);\n          doc.text(`Captured: ${new Date(lesion.capturedAt).toLocaleDateString()}`);\n          \n          if (lesion.analysis) {\n            doc.moveDown(0.3);\n            doc.fontSize(13).fillColor(\"#0891b2\").text(\"AI Analysis Results:\");\n            doc.fontSize(12).fillColor(\"#334155\");\n            doc.text(`Classification: ${lesion.analysis.classification}`);\n            doc.text(`Confidence: ${lesion.analysis.confidence}%`);\n            doc.text(`Benign Score: ${lesion.analysis.benignScore}%`);\n            doc.text(`Malignant Score: ${lesion.analysis.malignantScore}%`);\n            doc.text(`Rash Score: ${lesion.analysis.rashScore}%`);\n            doc.text(`Infection Score: ${lesion.analysis.infectionScore}%`);\n            doc.moveDown(0.3);\n            doc.fontSize(12).fillColor(\"#475569\");\n            // Limit AI response text to prevent overflow\n            const analysisText = lesion.analysis.aiResponse.length > 500\n              ? lesion.analysis.aiResponse.substring(0, 500) + \"...\"\n              : lesion.analysis.aiResponse;\n            doc.text(`Analysis: ${analysisText}`, {\n              width: 500,\n              align: \"justify\",\n            });\n          } else {\n            doc.text(\"Status: Pending analysis\");\n          }\n\n          if (lesion.notes) {\n            doc.moveDown(0.3);\n            doc.fontSize(12).fillColor(\"#475569\");\n            const notesText = lesion.notes.length > 300\n              ? lesion.notes.substring(0, 300) + \"...\"\n              : lesion.notes;\n            doc.text(`Clinical Notes: ${notesText}`, { width: 500, align: \"justify\" });\n          }\n\n          doc.moveDown(1.5);\n        });\n      }\n\n      // Footer\n      if (doc.y > 700) {\n        doc.addPage();\n      }\n      doc.fontSize(10).fillColor(\"#94a3b8\");\n      doc.text(`Report generated: ${new Date().toLocaleString()}`, { align: \"center\" });\n      doc.text(\"This report is for clinical use only\", { align: \"center\" });\n\n      // Finalize PDF\n      doc.end();\n    } catch (error: any) {\n      console.error(\"PDF generation error:\", error);\n      if (!res.headersSent) {\n        res.status(500).send(error.message);\n      }\n    }\n  });\n\n  // Serve uploaded images\n  app.use(\"/uploads\", async (req, res) => {\n    try {\n      // Extract and validate filename (remove leading slash and any path traversal)\n      const requestedFile = req.path.replace(/^\\//, \"\");\n      const safeFilename = path.basename(requestedFile);\n      \n      // Prevent directory traversal\n      if (safeFilename !== requestedFile || safeFilename.includes(\"..\")) {\n        return res.status(400).send(\"Invalid filename\");\n      }\n\n      const filepath = path.join(uploadsDir, safeFilename);\n      \n      // Verify file exists\n      await fs.access(filepath);\n      \n      // Send file\n      res.sendFile(filepath);\n    } catch {\n      res.status(404).send(\"Image not found\");\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":25254},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/app-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  Home,\n  UserPlus,\n  Camera,\n  Activity,\n  TrendingUp,\n  FileText,\n  User,\n  Scale,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\n\nconst menuItems = [\n  {\n    title: \"Dashboard\",\n    url: \"/\",\n    icon: Home,\n    testId: \"nav-dashboard\",\n  },\n  {\n    title: \"New Patient\",\n    url: \"/patients/new\",\n    icon: UserPlus,\n    testId: \"nav-new-patient\",\n  },\n  {\n    title: \"Capture Lesion\",\n    url: \"/capture\",\n    icon: Camera,\n    testId: \"nav-capture\",\n  },\n  {\n    title: \"Analysis History\",\n    url: \"/analyses\",\n    icon: Activity,\n    testId: \"nav-analyses\",\n  },\n  {\n    title: \"Progress Tracker\",\n    url: \"/progress\",\n    icon: TrendingUp,\n    testId: \"nav-progress\",\n  },\n  {\n    title: \"Reports\",\n    url: \"/reports\",\n    icon: FileText,\n    testId: \"nav-reports\",\n  },\n  {\n    title: \"Patient Portal\",\n    url: \"/patient-portal\",\n    icon: User,\n    testId: \"nav-patient-portal\",\n  },\n  {\n    title: \"AI Fairness\",\n    url: \"/fairness\",\n    icon: Scale,\n    testId: \"nav-fairness\",\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"border-b border-sidebar-border p-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary text-primary-foreground\">\n            <Activity className=\"h-6 w-6\" />\n          </div>\n          <div>\n            <h1 className=\"text-lg font-medium text-sidebar-foreground\">SAGAlyze</h1>\n            <p className=\"text-xs text-muted-foreground\">Dermatology Assistant</p>\n          </div>\n        </div>\n      </SidebarHeader>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Clinical Tools</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.url}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={item.testId}\n                  >\n                    <Link href={item.url}>\n                      <item.icon className=\"h-5 w-5\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n    </Sidebar>\n  );\n}\n","size_bytes":2707},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={() => setTheme(theme === \"light\" ? \"dark\" : \"light\")}\n      data-testid=\"button-theme-toggle\"\n    >\n      <Sun className=\"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n      <Moon className=\"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":666},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"server/openai.ts":{"content":"import OpenAI from \"openai\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n// Using Replit AI Integrations if available, otherwise fallback to user's OpenAI API key\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL || undefined,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n});\n\ninterface LesionAnalysisResult {\n  classification: string;\n  confidence: number;\n  benignScore: number;\n  malignantScore: number;\n  rashScore: number;\n  infectionScore: number;\n  reasoning: string;\n}\n\nexport async function analyzeLesionImage(base64Image: string): Promise<LesionAnalysisResult> {\n  // Validate API key is configured\n  if (!process.env.OPENAI_API_KEY && !process.env.AI_INTEGRATIONS_OPENAI_API_KEY) {\n    console.error(\"No OpenAI API key configured\");\n    throw new Error(\"OpenAI API key is not configured. Please set OPENAI_API_KEY in environment variables.\");\n  }\n\n  // Validate input\n  if (!base64Image || base64Image.length === 0) {\n    throw new Error(\"Invalid image data provided\");\n  }\n\n  try {\n    console.log(\"Starting lesion analysis with OpenAI GPT-5...\");\n    \n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an expert dermatology AI assistant. Analyze skin lesion images and classify them into one of four categories:\n1. Benign - Non-cancerous, harmless lesions\n2. Malignant - Potentially cancerous lesions requiring immediate attention\n3. Rash - Inflammatory skin conditions, dermatitis\n4. Infection - Bacterial, fungal, or viral skin infections\n\nProvide a detailed analysis with confidence scores for each category. Respond with JSON in this exact format:\n{\n  \"classification\": \"Benign|Malignant|Rash|Infection\",\n  \"confidence\": <integer 0-100 for primary classification>,\n  \"benignScore\": <integer 0-100>,\n  \"malignantScore\": <integer 0-100>,\n  \"rashScore\": <integer 0-100>,\n  \"infectionScore\": <integer 0-100>,\n  \"reasoning\": \"<brief clinical explanation>\"\n}`,\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: \"Analyze this skin lesion and provide classification with confidence scores.\",\n            },\n            {\n              type: \"image_url\",\n              image_url: {\n                url: `data:image/jpeg;base64,${base64Image}`,\n              },\n            },\n          ],\n        },\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 2048,\n    });\n\n    console.log(\"OpenAI API response received successfully\");\n\n    if (!response.choices || response.choices.length === 0) {\n      console.error(\"No choices in OpenAI response\");\n      throw new Error(\"Invalid response from OpenAI API\");\n    }\n\n    const messageContent = response.choices[0].message.content;\n    if (!messageContent) {\n      console.error(\"No content in OpenAI message\");\n      throw new Error(\"Empty response from OpenAI API\");\n    }\n\n    console.log(\"Parsing AI response...\");\n    const result = JSON.parse(messageContent);\n\n    // Validate required fields\n    if (!result.classification) {\n      console.error(\"Missing classification in AI response:\", result);\n      throw new Error(\"AI response missing classification\");\n    }\n\n    const analysisResult = {\n      classification: result.classification || \"Unknown\",\n      confidence: Math.max(0, Math.min(100, Math.round(result.confidence || 0))),\n      benignScore: Math.max(0, Math.min(100, Math.round(result.benignScore || 0))),\n      malignantScore: Math.max(0, Math.min(100, Math.round(result.malignantScore || 0))),\n      rashScore: Math.max(0, Math.min(100, Math.round(result.rashScore || 0))),\n      infectionScore: Math.max(0, Math.min(100, Math.round(result.infectionScore || 0))),\n      reasoning: result.reasoning || \"Analysis completed\",\n    };\n\n    console.log(\"Lesion analysis completed:\", analysisResult.classification);\n    return analysisResult;\n  } catch (error: any) {\n    console.error(\"OpenAI API error details:\", {\n      message: error.message,\n      status: error.status,\n      type: error.type,\n      code: error.code,\n    });\n\n    // Provide more specific error messages\n    if (error.status === 401) {\n      throw new Error(\"Invalid OpenAI API key. Please check your configuration.\");\n    } else if (error.status === 429) {\n      throw new Error(\"OpenAI API rate limit exceeded. Please try again later.\");\n    } else if (error.status === 400) {\n      throw new Error(\"Invalid request to OpenAI API. The image format may be unsupported.\");\n    } else if (error.message?.includes(\"JSON\")) {\n      throw new Error(\"Failed to parse AI response. Please try again.\");\n    }\n\n    throw new Error(`Failed to analyze lesion image: ${error.message || \"Unknown error\"}`);\n  }\n}\n","size_bytes":4915},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/pages/patient-portal.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ArrowLeft, Lock, Shield, User, Calendar, CheckCircle2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { format } from \"date-fns\";\nimport type { Patient, Lesion, Analysis } from \"@shared/schema\";\n\nconst tokenSchema = z.object({\n  token: z.string().min(12, \"Access token must be at least 12 characters\"),\n});\n\nconst identitySchema = z.object({\n  patientId: z.string().min(1, \"Patient ID is required\"),\n  name: z.string().min(1, \"Name is required\"),\n  dateOfBirth: z.string().min(1, \"Date of birth is required\"),\n});\n\ntype TokenFormData = z.infer<typeof tokenSchema>;\ntype IdentityFormData = z.infer<typeof identitySchema>;\n\ntype VerificationStep = \"token-entry\" | \"identity-verification\" | \"authenticated\";\n\nexport default function PatientPortal() {\n  const { toast } = useToast();\n  const [step, setStep] = useState<VerificationStep>(\"token-entry\");\n  const [accessToken, setAccessToken] = useState<string>(\"\");\n  const [verifiedToken, setVerifiedToken] = useState<string | null>(null);\n\n  const tokenForm = useForm<TokenFormData>({\n    resolver: zodResolver(tokenSchema),\n    defaultValues: {\n      token: \"\",\n    },\n  });\n\n  const identityForm = useForm<IdentityFormData>({\n    resolver: zodResolver(identitySchema),\n    defaultValues: {\n      patientId: \"\",\n      name: \"\",\n      dateOfBirth: \"\",\n    },\n  });\n\n  const verifyTokenMutation = useMutation({\n    mutationFn: async (data: TokenFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/patient-portal/verify-token\", data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      setAccessToken(tokenForm.getValues(\"token\"));\n      setStep(\"identity-verification\");\n      toast({\n        title: \"Token verified\",\n        description: \"Please provide your details to continue.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Invalid token\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const verifyIdentityMutation = useMutation({\n    mutationFn: async (data: IdentityFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/patient-portal/verify-patient\", {\n        token: accessToken,\n        ...data,\n      });\n      return (await response.json()) as { verified: boolean; accessToken: string };\n    },\n    onSuccess: (data: { verified: boolean; accessToken: string }) => {\n      setVerifiedToken(data.accessToken);\n      setStep(\"authenticated\");\n      toast({\n        title: \"Access granted\",\n        description: \"Welcome to your patient portal.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Verification failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const { data: patientData, isLoading: isLoadingData } = useQuery<{\n    patient: Patient;\n    lesions: (Lesion & { analysis?: Analysis })[];\n  }>({\n    queryKey: [\"/api/patient-portal/data\", verifiedToken],\n    enabled: !!verifiedToken && step === \"authenticated\",\n  });\n\n  const onTokenSubmit = (data: TokenFormData) => {\n    verifyTokenMutation.mutate(data);\n  };\n\n  const onIdentitySubmit = (data: IdentityFormData) => {\n    verifyIdentityMutation.mutate(data);\n  };\n\n  const handleLogout = () => {\n    setStep(\"token-entry\");\n    setAccessToken(\"\");\n    setVerifiedToken(null);\n    tokenForm.reset();\n    identityForm.reset();\n  };\n\n  // Step 1: Token Entry\n  if (step === \"token-entry\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full p-8\">\n          <div className=\"text-center mb-8\">\n            <div className=\"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4\">\n              <Shield className=\"h-8 w-8 text-primary\" />\n            </div>\n            <h1 className=\"text-2xl font-medium text-card-foreground\">Patient Portal</h1>\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              Enter your access token to begin\n            </p>\n          </div>\n\n          <Form {...tokenForm}>\n            <form onSubmit={tokenForm.handleSubmit(onTokenSubmit)} className=\"space-y-6\">\n              <FormField\n                control={tokenForm.control}\n                name=\"token\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Access Token</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"Enter your access token\"\n                          className=\"pl-10 font-mono\"\n                          {...field}\n                          data-testid=\"input-token\"\n                        />\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={verifyTokenMutation.isPending}\n                data-testid=\"button-verify-token\"\n              >\n                {verifyTokenMutation.isPending ? \"Verifying...\" : \"Continue\"}\n              </Button>\n            </form>\n          </Form>\n\n          <div className=\"mt-6 pt-6 border-t border-border text-center\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-back-home\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Home\n              </Button>\n            </Link>\n          </div>\n\n          <div className=\"mt-6 p-4 rounded-md bg-muted\">\n            <p className=\"text-xs text-muted-foreground\">\n              Your access token was provided by your healthcare provider. Contact your doctor if you need assistance.\n            </p>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // Step 2: Identity Verification\n  if (step === \"identity-verification\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full p-8\">\n          <div className=\"text-center mb-8\">\n            <div className=\"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4\">\n              <CheckCircle2 className=\"h-8 w-8 text-primary\" />\n            </div>\n            <h1 className=\"text-2xl font-medium text-card-foreground\">Verify Your Identity</h1>\n            <p className=\"text-sm text-muted-foreground mt-2\">\n              Please confirm your details to access your records\n            </p>\n          </div>\n\n          <Form {...identityForm}>\n            <form onSubmit={identityForm.handleSubmit(onIdentitySubmit)} className=\"space-y-5\">\n              <FormField\n                control={identityForm.control}\n                name=\"patientId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Patient ID</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <User className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"Enter your patient ID\"\n                          className=\"pl-10\"\n                          {...field}\n                          data-testid=\"input-patient-id\"\n                        />\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={identityForm.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Full Name</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <User className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          placeholder=\"Enter your full name\"\n                          className=\"pl-10\"\n                          {...field}\n                          data-testid=\"input-name\"\n                        />\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={identityForm.control}\n                name=\"dateOfBirth\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Date of Birth</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                        <Input\n                          type=\"date\"\n                          className=\"pl-10\"\n                          {...field}\n                          data-testid=\"input-dob\"\n                        />\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex gap-3 pt-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleLogout}\n                  className=\"flex-1\"\n                  data-testid=\"button-back\"\n                >\n                  Back\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1\"\n                  disabled={verifyIdentityMutation.isPending}\n                  data-testid=\"button-verify-identity\"\n                >\n                  {verifyIdentityMutation.isPending ? \"Verifying...\" : \"Access Portal\"}\n                </Button>\n              </div>\n            </form>\n          </Form>\n\n          <div className=\"mt-6 p-4 rounded-md bg-muted\">\n            <p className=\"text-xs text-muted-foreground\">\n              For your security, all information must match our records exactly.\n            </p>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // Step 3: Authenticated - Show Patient Data\n  return (\n    <div className=\"container max-w-6xl mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-medium text-foreground\">Your Medical Records</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            View your lesion analysis history\n          </p>\n        </div>\n        <Button variant=\"outline\" onClick={handleLogout} data-testid=\"button-logout\">\n          Logout\n        </Button>\n      </div>\n\n      {isLoadingData && (\n        <Card className=\"p-12 text-center\">\n          <div className=\"h-12 w-12 rounded-full border-4 border-muted border-t-primary animate-spin mx-auto mb-4\" />\n          <p className=\"text-sm text-muted-foreground\">Loading your records...</p>\n        </Card>\n      )}\n\n      {patientData && (\n        <>\n          <Card className=\"p-6\">\n            <h2 className=\"text-xl font-medium text-card-foreground mb-4\">\n              Patient Information\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Name</p>\n                <p className=\"text-base font-medium text-card-foreground\" data-testid=\"text-patient-name\">\n                  {patientData.patient.name}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Patient ID</p>\n                <p className=\"text-base font-mono text-card-foreground\" data-testid=\"text-patient-id\">\n                  {patientData.patient.patientId}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Date of Birth</p>\n                <p className=\"text-base text-card-foreground\">\n                  {format(new Date(patientData.patient.dateOfBirth), \"MMM d, yyyy\")}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Gender</p>\n                <p className=\"text-base text-card-foreground\">{patientData.patient.gender}</p>\n              </div>\n            </div>\n          </Card>\n\n          <div>\n            <h2 className=\"text-xl font-medium text-foreground mb-4\">Lesion History</h2>\n            {patientData.lesions.length > 0 ? (\n              <div className=\"space-y-4\">\n                {patientData.lesions.map((lesion) => (\n                  <Card key={lesion.id} className=\"p-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                      <div className=\"aspect-square rounded-md border-2 border-border overflow-hidden bg-muted\">\n                        <img\n                          src={lesion.imagePath}\n                          alt={`Lesion at ${lesion.location}`}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      </div>\n                      <div className=\"md:col-span-2 space-y-4\">\n                        <div>\n                          <h3 className=\"text-lg font-medium text-card-foreground\">\n                            {lesion.location}\n                          </h3>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Captured on {format(new Date(lesion.capturedAt), \"MMMM d, yyyy\")}\n                          </p>\n                        </div>\n                        {lesion.analysis && (\n                          <div className=\"space-y-3\">\n                            <div>\n                              <p className=\"text-sm text-muted-foreground mb-2\">Classification</p>\n                              <Badge variant=\"secondary\" className=\"text-sm\">\n                                {lesion.analysis.classification}\n                              </Badge>\n                            </div>\n                            <div>\n                              <p className=\"text-sm text-muted-foreground mb-2\">Confidence Score</p>\n                              <p className=\"text-2xl font-medium text-card-foreground\">\n                                {lesion.analysis.confidence}%\n                              </p>\n                            </div>\n                            {lesion.analysis.aiResponse && (\n                              <div>\n                                <p className=\"text-sm text-muted-foreground mb-2\">Analysis</p>\n                                <p className=\"text-sm text-card-foreground leading-relaxed\">\n                                  {lesion.analysis.aiResponse}\n                                </p>\n                              </div>\n                            )}\n                          </div>\n                        )}\n                        {lesion.notes && (\n                          <div>\n                            <p className=\"text-sm text-muted-foreground mb-2\">Clinical Notes</p>\n                            <p className=\"text-sm text-card-foreground\">{lesion.notes}</p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card className=\"p-12 text-center\">\n                <Shield className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-card-foreground\">No records found</h3>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  No lesion analyses have been recorded yet\n                </p>\n              </Card>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":16711},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"replit.md":{"content":"# SAGAlyze - Smart AI Dermatology Assistant\n\n## Overview\n\nSAGAlyze is a full-stack clinical web application designed for dermatologists to classify skin lesions using AI, track patient progress over time, and generate comprehensive medical reports. The system prioritizes data privacy, offline capability, and fairness across all Fitzpatrick skin tones while maintaining a professional medical interface.\n\n**Core Capabilities:**\n- AI-powered skin lesion classification (Benign, Malignant, Rash, Infection)\n- Patient management with medical record tracking\n- Before/after lesion comparison with visual analysis\n- PDF report generation for clinical documentation\n- Secure patient portal with OTP-based access\n- **AI Fairness Calibration** - Bias detection and monitoring across Fitzpatrick skin tones\n- Medical-grade UI following Material Design principles\n\n## Recent Changes\n\n**November 22, 2025: Secure Patient Portal Token System with Two-Step Verification**\n- Implemented HIPAA-grade security with hybrid hashing: HMAC-SHA256 for efficient lookup + bcrypt (10 rounds) for secure verification\n- Added two-step patient verification: Step 1 verifies token exists, Step 2 verifies patient identity (token + Patient ID + name + DOB)\n- Created permanent access tokens auto-generated on patient creation with one-time plaintext reveal to clinicians\n- Implemented token regeneration capability for lost tokens with confirmation dialogs\n- Added comprehensive audit logging (portalAccessLogs table) tracking all access attempts with IP addresses and failure reasons\n- Implemented rate limiting (10 attempts per 15 minutes per IP) to prevent brute force attacks\n- Added tokenLookupHash field to patients table for deterministic database queries while maintaining bcrypt security\n- Enhanced UX with copy-to-clipboard functionality and security warnings in token reveal dialogs\n- Scoped patient data projection excludes sensitive fields (accessToken) from portal API responses\n\n**November 16, 2025: Enhanced Progress Tracker with Interactive Image Comparison**\n- Implemented interactive drag slider for side-by-side lesion comparison\n- Added clinical improvement calculation algorithm with severity mapping (Benign=1, Rash=2, Infection=3, Malignant=4)\n- Created bidirectional progress metrics showing positive improvement scores and negative deterioration scores\n- Added trend indicators (Improved/Worsened/No Change) with color-coded badges and icons\n- Implemented visual progress bars with contextual colors (green for improvement, red for deterioration)\n- Enhanced mobile touch interaction with preventDefault and touchAction safeguards\n- Added accessibility features (ARIA attributes, keyboard focus support)\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework:** React 18 with Vite for fast development and optimized builds\n\n**UI Component System:** \n- shadcn/ui components built on Radix UI primitives\n- Tailwind CSS for styling with custom medical theme\n- Design follows Material Design adapted for healthcare (see `design_guidelines.md`)\n- Roboto font family for professional medical aesthetic\n\n**State Management:**\n- TanStack React Query (v5) for server state management and caching\n- React Hook Form with Zod validation for form handling\n- Wouter for lightweight client-side routing\n\n**Key Design Decisions:**\n- **Material Design over custom framework:** Provides familiar, accessible patterns appropriate for clinical software\n- **Tailwind + shadcn/ui:** Enables rapid component development while maintaining consistency\n- **Image-first layout:** Lesion photographs are primary content, given visual prominence in all views\n- **Responsive grid system:** 2-3 column layouts for patient cards, single column for forms (max-w-2xl)\n\n### Backend Architecture\n\n**Framework:** Express.js with TypeScript running on Node.js\n\n**API Design:**\n- RESTful endpoints organized by resource type (patients, lesions, analyses, reports)\n- Multer middleware for image upload handling (10MB limit, image files only)\n- Session-based authentication approach (session storage configured)\n- File storage in `/uploads` directory for lesion images\n\n**Key Routes:**\n- `/api/patients` - CRUD operations for patient records\n- `/api/patients/:id/lesions` - Lesion management per patient\n- `/api/analyze-lesion` - AI classification endpoint\n- `/api/reports/generate/:id` - PDF report generation\n- `/api/patient-portal/verify` - OTP-based patient access\n- `/api/fairness/*` - Bias detection, ground truth tracking, and fairness metrics\n\n**AI Integration:**\n- Google Gemini 2.5 Flash API for lesion image analysis via Replit AI Integrations (switched from OpenAI per user request)\n- Returns structured JSON with classification, confidence scores (0-100), and clinical reasoning\n- Four classification categories: Benign, Malignant, Rash, Infection\n- Base64 image encoding for API transmission\n- Uses AI_INTEGRATIONS_GEMINI_BASE_URL and AI_INTEGRATIONS_GEMINI_API_KEY environment variables\n\n**Storage Layer:**\n- Abstract `IStorage` interface in `server/storage.ts` defines data operations\n- **DbStorage** implementation uses PostgreSQL via Drizzle ORM for persistent data storage\n- Schema includes: users, patients, lesions, analyses, patient_tokens tables\n- Uses UUID primary keys with `gen_random_uuid()`\n- Timestamps track creation and updates\n- Database schema synced using `npm run db:push` command\n\n**Key Design Decisions:**\n- **Express over Next.js API routes:** Separation of concerns, easier to scale backend independently\n- **OpenAI GPT-5 for AI:** Provides vision analysis without requiring local model infrastructure; simplifies deployment\n- **Abstract storage interface:** Enables future database swapping or adding caching layers\n- **File-based image storage:** Simple approach suitable for prototype; images referenced by path in database\n\n### Data Storage\n\n**Database:** PostgreSQL (configured via Drizzle ORM)\n\n**Schema Structure:**\n\n1. **users** - Clinician accounts\n   - id (UUID), username (unique), password (hashed), fullName, createdAt\n\n2. **patients** - Patient medical records\n   - id (UUID), patientId (unique identifier), name, dateOfBirth, gender\n   - fitzpatrickType (skin tone classification for fairness tracking)\n   - contactEmail, contactPhone, timestamps\n\n3. **lesions** - Captured lesion images\n   - id (UUID), patientId (foreign key), location (body part), imagePath\n   - notes (clinical observations), capturedAt timestamp\n\n4. **analyses** - AI classification results\n   - id (UUID), lesionId (foreign key), classification, confidence (0-100)\n   - benignScore, malignantScore, rashScore, infectionScore\n   - reasoning (clinical explanation), analyzedAt timestamp\n   - groundTruthLabel, groundTruthSource, groundTruthRecordedAt (for fairness calibration)\n\n5. **patient_tokens** - Temporary access tokens for patient portal\n   - token (primary key), patientId (foreign key), expiresAt timestamp\n\n6. **fairness_audit_runs** - AI fairness audit metadata\n   - id (UUID), startDate, endDate, totalSamples, samplesWithGroundTruth\n   - overallDisparityScore, demographicParityGap, equalOpportunityGap, calibrationGap\n   - parityAlert, opportunityAlert, calibrationAlert (boolean flags), runAt timestamp\n\n7. **fairness_metrics** - Per-skin-tone bias statistics\n   - id (UUID), auditRunId (foreign key), fitzpatrickType\n   - Confusion matrix: truePositives, falsePositives, trueNegatives, falseNegatives\n   - Performance metrics: positiveRate, truePositiveRate, falsePositiveRate\n   - precision, recall, f1Score, brierScore, averageConfidence, accuracyAtConfidence\n\n**Migration Management:** Drizzle Kit with migrations stored in `/migrations` directory\n\n**Key Design Decisions:**\n- **PostgreSQL chosen for reliability:** ACID compliance critical for medical data\n- **Separate analyses table:** Allows multiple analyses per lesion over time for progress tracking\n- **Fitzpatrick type tracking:** Ensures fairness monitoring across skin tones as specified in requirements\n- **Time-limited patient tokens:** Security-first approach for patient portal access\n\n### External Dependencies\n\n**AI/ML Services:**\n- OpenAI API (GPT-5) - Vision-based lesion classification and analysis\n- API key configured via `OPENAI_API_KEY` environment variable\n\n**Database:**\n- Neon PostgreSQL serverless database\n- Connection via `@neondatabase/serverless` driver\n- Configured through `DATABASE_URL` environment variable\n\n**File Upload:**\n- Multer for multipart/form-data handling\n- Local filesystem storage in `/uploads` directory\n\n**PDF Generation:**\n- PDFKit for creating clinical reports\n- Generates downloadable patient progress reports\n\n**Session Management:**\n- connect-pg-simple for PostgreSQL-backed sessions\n- Enables secure authentication state persistence\n\n**UI Component Libraries:**\n- Radix UI primitives (19 components imported) - Accessible, unstyled components\n- Lucide React - Icon library with medical/clinical icons\n- date-fns - Date formatting and manipulation\n\n**Development Tools:**\n- Vite with React plugin for fast HMR\n- Replit-specific plugins for runtime error handling and development features\n- ESBuild for production server bundling\n\n**Key Design Decisions:**\n- **Serverless database (Neon):** Reduces infrastructure management, scales automatically\n- **OpenAI over local ML models:** Prioritizes development speed; local inference can be added later\n- **PostgreSQL session storage:** More robust than in-memory for production medical applications\n- **Radix UI foundation:** Ensures WCAG compliance critical for medical software accessibility\n\n### AI Fairness Calibration System\n\n**Overview:**\nThe application includes a comprehensive bias detection and calibration system that monitors AI performance across Fitzpatrick skin tone classifications (I-VI). This ensures equitable diagnostic accuracy regardless of patient skin tone.\n\n**Key Components:**\n\n1. **Ground Truth Collection** (`/analyses` page)\n   - Clinicians can verify AI predictions by recording correct diagnoses\n   - Ground truth labels validated against classification vocabulary (Benign, Malignant, Rash, Infection)\n   - Source tracking (clinician_review) for audit trails\n\n2. **Fairness Metrics Calculation** (`server/fairness.ts`)\n   - **Demographic Parity:** Measures equal positive prediction rates across skin tones\n   - **Equal Opportunity:** Tracks true positive rate (TPR) equity across groups\n   - **Calibration Metrics:** Brier score to assess prediction confidence accuracy\n   - Confusion matrix statistics per Fitzpatrick type (TP, FP, TN, FN)\n   - Performance metrics: precision, recall, F1 score per skin tone\n\n3. **Audit Runs** (triggered manually or scheduled)\n   - Aggregates fairness metrics over configurable time windows (7, 30, 90 days)\n   - Calculates disparity gaps: max-min difference across skin tone groups\n   - Automated alert system with configurable thresholds:\n     - Demographic parity gap > 15%\n     - Equal opportunity gap > 15%\n     - Calibration gap > 10%\n\n4. **Fairness Dashboard** (`/fairness` page)\n   - Real-time bias alerts with severity indicators\n   - Summary cards: overall disparity score, demographic parity, equal opportunity, calibration\n   - Visualizations: positive rate comparison, performance metrics, confusion matrices\n   - Historical audit run tracking for trend analysis\n\n**Workflow:**\n1. Clinicians analyze lesions using AI (existing functionality)\n2. Clinicians verify diagnoses on Analysis History page â†’ ground truth recorded\n3. System accumulates verified samples across all Fitzpatrick types\n4. Clinician triggers fairness audit via dashboard \"Calculate Metrics\" button\n5. System computes bias metrics and generates alerts if thresholds exceeded\n6. Dashboard displays results with actionable insights for bias mitigation\n\n**Technical Implementation:**\n- API Endpoints:\n  - `POST /api/fairness/update-ground-truth` - Record verified diagnosis\n  - `POST /api/fairness/calculate` - Trigger fairness audit run\n  - `GET /api/fairness/audit-runs` - Retrieve historical audits\n  - `GET /api/fairness/alerts` - Get active bias alerts\n- Fairness calculations use \"Malignant\" and \"Infection\" as positive class for medical urgency\n- All metrics stored in PostgreSQL for long-term monitoring and compliance\n\n**Key Design Decisions:**\n- **Clinician-driven ground truth:** Medical professionals verify AI predictions rather than automated systems\n- **Windowed analysis:** Time-based audits allow tracking bias trends over deployment lifecycle\n- **Alert thresholds:** Based on established fairness research (15% for parity/opportunity, 10% for calibration)\n- **Per-group metrics:** Fitzpatrick-specific statistics enable targeted bias investigation","size_bytes":12755},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"design_guidelines.md":{"content":"# SAGAlyze Design Guidelines\n\n## Design Approach\n**Material Design System** adapted for medical/clinical applications. Prioritizes clarity, efficiency, and professional trust over visual flair. Reference: Healthcare dashboards like Epic MyChart, athenahealth, with modern touches from Linear's clean data presentation.\n\n## Core Design Principles\n1. **Clinical Clarity**: Information hierarchy supports rapid decision-making\n2. **Professional Trust**: Conservative, clean aesthetic appropriate for medical context\n3. **Data Density**: Efficient use of space for patient information and medical images\n4. **Image-First**: Lesion images are primary contentâ€”give them prominence\n\n---\n\n## Typography System\n\n**Font Family**: Roboto (via Google Fonts CDN)\n- **Headings**: Roboto Medium (500)\n  - H1: 2rem (32px) - Page titles\n  - H2: 1.5rem (24px) - Section headers\n  - H3: 1.25rem (20px) - Card headers, patient names\n- **Body**: Roboto Regular (400)\n  - Default: 1rem (16px) - Main content\n  - Small: 0.875rem (14px) - Metadata, timestamps\n  - Caption: 0.75rem (12px) - Labels, badges\n- **Medical Data**: Roboto Mono Regular (400) at 0.875rem for patient IDs, confidence scores\n\n---\n\n## Layout System\n\n**Spacing Primitives**: Use Tailwind units of **2, 4, 6, 8, 12, 16** consistently\n- Component padding: p-4 or p-6\n- Section spacing: mb-8 or mb-12\n- Card gaps: gap-4 or gap-6\n- Page margins: p-6 on mobile, p-8 on desktop\n\n**Grid Structure**:\n- Dashboard: Sidebar (fixed 240px) + Main content (fluid)\n- Patient cards: 2 columns on tablet (md:grid-cols-2), 3 on desktop (lg:grid-cols-3)\n- Comparison view: 2-column equal split (grid-cols-2)\n- Forms: Single column, max-w-2xl centered\n\n---\n\n## Navigation Architecture\n\n**Side Navigation** (Desktop):\n- Fixed left sidebar, 240px width, full height\n- Logo at top with app name\n- Icon + label navigation items vertically stacked (gap-2)\n- Active state: subtle background fill\n- Icons: Material Icons via CDN\n- Bottom section: User profile, settings, logout\n\n**Top Bar** (Mobile):\n- Hamburger menu triggering drawer\n- App logo centered\n- Patient/context indicator on right\n\n**Navigation Items**:\n1. Dashboard (home icon)\n2. New Case (add icon)\n3. Capture Image (camera icon)\n4. Analysis History (analytics icon)\n5. Progress Tracker (trending_up icon)\n6. Reports (description icon)\n7. Patient Portal (person icon)\n\n---\n\n## Component Library\n\n### Dashboard Cards\n- White background (theme-aware), rounded-lg, shadow-sm\n- Padding: p-6\n- Header with icon, title (text-lg font-medium), and action button/menu\n- Content area with clean data presentation\n- Hover: subtle shadow-md transition\n\n### Patient List Items\n- Grid layout showing: Patient photo placeholder (40px circle), Name, ID, Last visit date, Status badge\n- Click target: entire card with hover:bg-gray-50 transition\n- Status badges: Small pill shape (px-3 py-1 rounded-full text-xs)\n\n### Image Viewer Components\n**Single Image Card**:\n- Large square/rectangle container (min 400px desktop, full-width mobile)\n- Border: border-2 border-gray-200\n- Thumbnail strip below for multiple angles (if applicable)\n- Metadata overlay: Semi-transparent bottom bar with date, location, zoom controls\n\n**Before/After Comparison**:\n- Two-column grid with equal widths (grid-cols-2 gap-4)\n- Each image in rounded container with label above\n- Synchronized zoom/pan controls\n- Metrics panel below: Side-by-side statistics showing % change, size comparison\n\n### Analysis Result Card\n- Prominent diagnosis display (text-2xl font-medium) at top\n- Confidence score: Large percentage (text-4xl) with circular progress indicator\n- Classification breakdown: Horizontal bar chart showing all 4 categories (benign, malignant, rash, infection)\n- Recommendation section: Border-l-4 with alert styling, text-base\n- Action buttons: \"Save to Report\", \"Request Second Opinion\" (filled vs outlined)\n\n### Progress Timeline\n- Vertical timeline with dot markers\n- Each entry: Date marker (left), Card with image thumbnail + brief diagnosis (right)\n- Connecting line between dots\n- Latest entry highlighted with primary accent\n\n### Forms\n- Label above input pattern (text-sm font-medium mb-2)\n- Input fields: border rounded-md, px-4 py-3, focus:ring-2\n- File upload: Dashed border drag-drop zone with icon + text\n- Camera capture: Full-width button with camera icon, opens modal with live preview\n\n### Reports Interface\n- Header with patient info block (name, ID, date range)\n- Sections divided by horizontal rules (my-8)\n- Image grid showing lesion history\n- Chart.js line graphs for trend visualization (max-w-3xl)\n- Export button: Primary action, top-right, with PDF icon\n\n### Patient Portal (OTP Login)\n- Centered card layout (max-w-md mx-auto)\n- Large OTP input (6-digit, individual boxes with gap-2)\n- Limited view: Read-only cards showing their own progress\n- No edit capabilities, simplified navigation\n\n---\n\n## Images\n\n**Hero Image**: None - This is a clinical application dashboard, not a marketing site. Jump directly to functional interface.\n\n**Medical Images**:\n- Lesion photos: High-resolution, square aspect ratio preferred, displayed in cards with subtle shadows\n- Placeholder: Gray background with medical cross icon when no image available\n- Image quality indicator: Small badge showing resolution/quality status\n\n**Icons**: Material Icons via CDN throughout\n- Navigation icons: 24px\n- Action buttons: 20px\n- Status indicators: 16px\n\n---\n\n## Buttons & Interactive Elements\n\n**Primary Actions**: Filled buttons (px-6 py-3 rounded-md, font-medium)\n- Used for: \"Analyze Lesion\", \"Save Report\", \"Generate PDF\"\n\n**Secondary Actions**: Outlined buttons (border-2, same padding)\n- Used for: \"Cancel\", \"View Details\", \"Compare\"\n\n**Text Buttons**: No background, underline on hover\n- Used for: \"Skip\", \"Learn More\", tertiary actions\n\n**Floating Action Button** (FAB):\n- Fixed bottom-right on main screens\n- \"Add New Case\" primary action (rounded-full, w-14 h-14, shadow-lg)\n\n---\n\n## Data Visualization\n\n**Confidence Scores**: Circular progress rings (120px diameter) with percentage centered\n**Trend Charts**: Line graphs via Chart.js, clean grid, single or dual-axis\n**Comparison Metrics**: Large numbers (text-3xl) with small delta indicators (arrows + %)\n**Status Indicators**: Color-coded dots (8px circle) with text label\n\n---\n\n## Responsive Behavior\n\n**Breakpoints**:\n- Mobile (<768px): Single column, bottom nav, stacked images\n- Tablet (768-1024px): 2-column grids, side drawer nav\n- Desktop (>1024px): Fixed sidebar, 3-column grids, side-by-side comparisons\n\n**Mobile Optimizations**:\n- Camera capture: Native camera input with live preview\n- Image comparison: Swipeable carousel instead of side-by-side\n- Navigation: Bottom tab bar with 5 primary items\n\n---\n\n## Theme Support\n\n**Light Theme** (Default):\n- Clean white backgrounds, gray-100 for secondary surfaces\n- Text: gray-900 primary, gray-600 secondary\n\n**Dark Theme**:\n- Dark gray-900 backgrounds, gray-800 for cards\n- Text: gray-100 primary, gray-400 secondary\n- Same component structure, inverted colors\n\n**Medical Accents** (consistent across themes):\n- Primary: Teal-600 (trust, medical)\n- Success: Green-600 (benign results)\n- Warning: Amber-600 (caution)\n- Error: Red-600 (malignant alerts)\n\n---\n\n## Animation Guidelines\n\n**Minimal animations** - Medical context requires stability:\n- Page transitions: Simple fade (200ms)\n- Card hover: Shadow elevation only\n- Loading states: Subtle spinner, no skeleton screens\n- NO scroll-triggered animations or parallax effects","size_bytes":7509},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"server/fairness.ts":{"content":"import type { Analysis, Patient } from \"@shared/schema\";\n\nexport interface AnalysisWithPatient {\n  analysis: Analysis;\n  patient: Patient;\n}\n\nexport interface ConfusionMatrix {\n  truePositives: number;\n  falsePositives: number;\n  trueNegatives: number;\n  falseNegatives: number;\n}\n\nexport interface FairnessMetrics {\n  fitzpatrickType: string;\n  totalPredictions: number;\n  positivePredictions: number;\n  truePositives: number;\n  falsePositives: number;\n  trueNegatives: number;\n  falseNegatives: number;\n  positiveRate: number;\n  truePositiveRate: number;\n  falsePositiveRate: number;\n  precision: number;\n  recall: number;\n  f1Score: number;\n  brierScore: number;\n  averageConfidence: number;\n  accuracyAtConfidence: number;\n}\n\nexport interface DisparityMetrics {\n  overallDisparityScore: number;\n  demographicParityGap: number;\n  equalOpportunityGap: number;\n  calibrationGap: number;\n  parityAlert: boolean;\n  opportunityAlert: boolean;\n  calibrationAlert: boolean;\n}\n\nconst POSITIVE_CLASSIFICATIONS = [\"Malignant\", \"Infection\"];\nconst PARITY_THRESHOLD = 0.15;\nconst OPPORTUNITY_THRESHOLD = 0.15;\nconst CALIBRATION_THRESHOLD = 0.10;\n\nfunction isPositivePrediction(classification: string): boolean {\n  return POSITIVE_CLASSIFICATIONS.includes(classification);\n}\n\nfunction isPositiveGroundTruth(groundTruth: string): boolean {\n  return POSITIVE_CLASSIFICATIONS.includes(groundTruth);\n}\n\nfunction calculateConfusionMatrix(\n  predictions: Array<{ classification: string; groundTruth: string }>\n): ConfusionMatrix {\n  let tp = 0;\n  let fp = 0;\n  let tn = 0;\n  let fn = 0;\n\n  for (const { classification, groundTruth } of predictions) {\n    const predictedPositive = isPositivePrediction(classification);\n    const actualPositive = isPositiveGroundTruth(groundTruth);\n\n    if (predictedPositive && actualPositive) tp++;\n    else if (predictedPositive && !actualPositive) fp++;\n    else if (!predictedPositive && !actualPositive) tn++;\n    else if (!predictedPositive && actualPositive) fn++;\n  }\n\n  return { truePositives: tp, falsePositives: fp, trueNegatives: tn, falseNegatives: fn };\n}\n\nfunction calculateBrierScore(\n  predictions: Array<{ confidence: number; groundTruth: string; classification: string }>\n): number {\n  if (predictions.length === 0) return 0;\n\n  let totalSquaredError = 0;\n\n  for (const pred of predictions) {\n    const predictedProb = pred.confidence / 100;\n    const actualOutcome = pred.classification === pred.groundTruth ? 1 : 0;\n    totalSquaredError += Math.pow(predictedProb - actualOutcome, 2);\n  }\n\n  return totalSquaredError / predictions.length;\n}\n\nexport function calculateFairnessMetricsPerGroup(\n  analysesWithPatients: AnalysisWithPatient[]\n): FairnessMetrics[] {\n  const groupedByFitzpatrick = new Map<string, AnalysisWithPatient[]>();\n\n  for (const item of analysesWithPatients) {\n    if (!item.analysis.groundTruthLabel) continue;\n    \n    const fitzType = item.patient.fitzpatrickType || \"Unknown\";\n    if (!groupedByFitzpatrick.has(fitzType)) {\n      groupedByFitzpatrick.set(fitzType, []);\n    }\n    groupedByFitzpatrick.get(fitzType)!.push(item);\n  }\n\n  const metrics: FairnessMetrics[] = [];\n\n  for (const [fitzpatrickType, items] of Array.from(groupedByFitzpatrick.entries())) {\n    const predictions = items.map((item: AnalysisWithPatient) => ({\n      classification: item.analysis.classification,\n      groundTruth: item.analysis.groundTruthLabel!,\n      confidence: item.analysis.confidence,\n    }));\n\n    const confusionMatrix = calculateConfusionMatrix(predictions);\n    const { truePositives, falsePositives, trueNegatives, falseNegatives } = confusionMatrix;\n\n    const totalPredictions = items.length;\n    const positivePredictions = items.filter((item: AnalysisWithPatient) =>\n      isPositivePrediction(item.analysis.classification)\n    ).length;\n\n    const positiveRate = totalPredictions > 0 ? positivePredictions / totalPredictions : 0;\n\n    const truePositiveRate =\n      truePositives + falseNegatives > 0 ? truePositives / (truePositives + falseNegatives) : 0;\n\n    const falsePositiveRate =\n      falsePositives + trueNegatives > 0 ? falsePositives / (falsePositives + trueNegatives) : 0;\n\n    const precision =\n      truePositives + falsePositives > 0 ? truePositives / (truePositives + falsePositives) : 0;\n\n    const recall = truePositiveRate;\n\n    const f1Score =\n      precision + recall > 0 ? (2 * precision * recall) / (precision + recall) : 0;\n\n    const brierScore = calculateBrierScore(predictions);\n\n    const averageConfidence =\n      predictions.reduce((sum: number, p: { confidence: number }) => sum + p.confidence, 0) / predictions.length;\n\n    const correctPredictions = items.filter(\n      (item: AnalysisWithPatient) => item.analysis.classification === item.analysis.groundTruthLabel\n    ).length;\n    const accuracyAtConfidence = totalPredictions > 0 ? correctPredictions / totalPredictions : 0;\n\n    metrics.push({\n      fitzpatrickType,\n      totalPredictions,\n      positivePredictions,\n      truePositives,\n      falsePositives,\n      trueNegatives,\n      falseNegatives,\n      positiveRate,\n      truePositiveRate,\n      falsePositiveRate,\n      precision,\n      recall,\n      f1Score,\n      brierScore,\n      averageConfidence,\n      accuracyAtConfidence,\n    });\n  }\n\n  return metrics;\n}\n\nexport function calculateDisparityMetrics(metrics: FairnessMetrics[]): DisparityMetrics {\n  if (metrics.length === 0) {\n    return {\n      overallDisparityScore: 0,\n      demographicParityGap: 0,\n      equalOpportunityGap: 0,\n      calibrationGap: 0,\n      parityAlert: false,\n      opportunityAlert: false,\n      calibrationAlert: false,\n    };\n  }\n\n  const positiveRates = metrics.map((m) => m.positiveRate);\n  const truePositiveRates = metrics.map((m) => m.truePositiveRate);\n  const brierScores = metrics.map((m) => m.brierScore);\n\n  const demographicParityGap = Math.max(...positiveRates) - Math.min(...positiveRates);\n  const equalOpportunityGap = Math.max(...truePositiveRates) - Math.min(...truePositiveRates);\n  const calibrationGap = Math.max(...brierScores) - Math.min(...brierScores);\n\n  const overallDisparityScore =\n    (demographicParityGap + equalOpportunityGap + calibrationGap) / 3;\n\n  const parityAlert = demographicParityGap > PARITY_THRESHOLD;\n  const opportunityAlert = equalOpportunityGap > OPPORTUNITY_THRESHOLD;\n  const calibrationAlert = calibrationGap > CALIBRATION_THRESHOLD;\n\n  return {\n    overallDisparityScore,\n    demographicParityGap,\n    equalOpportunityGap,\n    calibrationGap,\n    parityAlert,\n    opportunityAlert,\n    calibrationAlert,\n  };\n}\n","size_bytes":6559},"server/gemini.ts":{"content":"import { GoogleGenAI, Type } from \"@google/genai\";\n\n// Using Replit's AI Integrations service for Gemini - this was set up per user request to replace OpenAI\n// Supported models: gemini-2.5-flash (fast), gemini-2.5-pro (advanced reasoning)\nconst ai = new GoogleGenAI({\n  apiKey: process.env.AI_INTEGRATIONS_GEMINI_API_KEY!,\n  httpOptions: {\n    apiVersion: \"\",\n    baseUrl: process.env.AI_INTEGRATIONS_GEMINI_BASE_URL!,\n  },\n});\n\ninterface LesionAnalysisResult {\n  classification: string;\n  confidence: number;\n  benignScore: number;\n  malignantScore: number;\n  rashScore: number;\n  infectionScore: number;\n  reasoning: string;\n}\n\nexport async function analyzeLesionImage(base64Image: string): Promise<LesionAnalysisResult> {\n  // Validate API key is configured\n  if (!process.env.AI_INTEGRATIONS_GEMINI_API_KEY || !process.env.AI_INTEGRATIONS_GEMINI_BASE_URL) {\n    console.error(\"No Gemini API configuration found\");\n    throw new Error(\"Gemini API is not configured. Please set up the Gemini integration.\");\n  }\n\n  // Validate input\n  if (!base64Image || base64Image.length === 0) {\n    throw new Error(\"Invalid image data provided\");\n  }\n\n  try {\n    console.log(\"Starting lesion analysis with Google Gemini 2.5 Flash...\");\n    \n    const prompt = `You are an expert dermatology AI assistant. Analyze this skin lesion image and classify it into one of four categories:\n\n1. Benign - Non-cancerous, harmless lesions\n2. Malignant - Potentially cancerous lesions requiring immediate attention\n3. Rash - Inflammatory skin conditions, dermatitis\n4. Infection - Bacterial, fungal, or viral skin infections\n\nProvide a detailed analysis with confidence scores for each category.`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.5-flash\",\n      contents: [{\n        role: \"user\",\n        parts: [\n          { text: prompt },\n          { \n            inlineData: { \n              mimeType: \"image/jpeg\", \n              data: base64Image \n            } \n          }\n        ]\n      }],\n      config: {\n        responseMimeType: \"application/json\",\n        responseSchema: {\n          type: Type.OBJECT,\n          properties: {\n            classification: { \n              type: Type.STRING,\n              description: \"Must be one of: Benign, Malignant, Rash, Infection\"\n            },\n            confidence: { \n              type: Type.INTEGER,\n              description: \"Confidence score 0-100 for the primary classification\"\n            },\n            benignScore: { \n              type: Type.INTEGER,\n              description: \"Probability score 0-100 that the lesion is benign\"\n            },\n            malignantScore: { \n              type: Type.INTEGER,\n              description: \"Probability score 0-100 that the lesion is malignant\"\n            },\n            rashScore: { \n              type: Type.INTEGER,\n              description: \"Probability score 0-100 that the lesion is a rash\"\n            },\n            infectionScore: { \n              type: Type.INTEGER,\n              description: \"Probability score 0-100 that the lesion is an infection\"\n            },\n            reasoning: { \n              type: Type.STRING,\n              description: \"Brief clinical explanation for the classification\"\n            }\n          },\n          required: [\"classification\", \"confidence\", \"benignScore\", \"malignantScore\", \"rashScore\", \"infectionScore\", \"reasoning\"]\n        }\n      }\n    });\n\n    console.log(\"Gemini API response received successfully\");\n\n    // Get the response text - in Gemini SDK this is a property (getter)\n    const responseText = response.text;\n    console.log(\"Response text type:\", typeof responseText);\n    if (responseText && typeof responseText === 'string') {\n      console.log(\"Response text preview:\", responseText.substring(0, Math.min(100, responseText.length)));\n    }\n    \n    if (!responseText || typeof responseText !== 'string') {\n      console.error(\"Invalid response text from Gemini - type:\", typeof responseText);\n      throw new Error(\"Empty or invalid response from Gemini API\");\n    }\n\n    console.log(\"Parsing AI response...\");\n    const result = JSON.parse(responseText);\n\n    // Validate required fields\n    if (!result.classification) {\n      console.error(\"Missing classification in AI response:\", result);\n      throw new Error(\"AI response missing classification\");\n    }\n\n    // Validate classification is one of the expected values\n    const validClassifications = [\"Benign\", \"Malignant\", \"Rash\", \"Infection\"];\n    if (!validClassifications.includes(result.classification)) {\n      console.error(\"Invalid classification value:\", result.classification);\n      // Try to map to a valid classification\n      const normalized = result.classification.charAt(0).toUpperCase() + result.classification.slice(1).toLowerCase();\n      if (validClassifications.includes(normalized)) {\n        result.classification = normalized;\n      } else {\n        throw new Error(`Invalid classification: ${result.classification}. Must be one of: ${validClassifications.join(\", \")}`);\n      }\n    }\n\n    const analysisResult = {\n      classification: result.classification,\n      confidence: Math.max(0, Math.min(100, Math.round(result.confidence || 0))),\n      benignScore: Math.max(0, Math.min(100, Math.round(result.benignScore || 0))),\n      malignantScore: Math.max(0, Math.min(100, Math.round(result.malignantScore || 0))),\n      rashScore: Math.max(0, Math.min(100, Math.round(result.rashScore || 0))),\n      infectionScore: Math.max(0, Math.min(100, Math.round(result.infectionScore || 0))),\n      reasoning: result.reasoning || \"Analysis completed\",\n    };\n\n    console.log(\"Lesion analysis completed:\", analysisResult.classification);\n    return analysisResult;\n  } catch (error: any) {\n    console.error(\"Gemini API error details:\", {\n      message: error.message,\n      status: error.status,\n      type: error.type,\n      code: error.code,\n    });\n\n    // Provide more specific error messages\n    if (error.status === 401 || error.message?.includes(\"401\")) {\n      throw new Error(\"Invalid Gemini API configuration. Please check your setup.\");\n    } else if (error.status === 429 || error.message?.includes(\"429\") || error.message?.toLowerCase().includes(\"rate limit\")) {\n      throw new Error(\"Gemini API rate limit exceeded. Please try again later.\");\n    } else if (error.status === 400 || error.message?.includes(\"400\")) {\n      throw new Error(\"Invalid request to Gemini API. The image format may be unsupported.\");\n    } else if (error.message?.includes(\"JSON\")) {\n      throw new Error(\"Failed to parse AI response. Please try again.\");\n    }\n\n    throw new Error(`Failed to analyze lesion image: ${error.message || \"Unknown error\"}`);\n  }\n}\n","size_bytes":6727},"client/src/pages/fairness-calibration.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { AlertTriangle, CheckCircle, BarChart3, TrendingUp, Calculator } from \"lucide-react\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface FairnessMetric {\n  fitzpatrickType: string;\n  totalPredictions: number;\n  positivePredictions: number;\n  truePositives: number;\n  falsePositives: number;\n  trueNegatives: number;\n  falseNegatives: number;\n  positiveRate: number;\n  truePositiveRate: number;\n  falsePositiveRate: number;\n  precision: number;\n  recall: number;\n  f1Score: number;\n  brierScore: number;\n  averageConfidence: number;\n  accuracyAtConfidence: number;\n}\n\ninterface AuditRun {\n  id: string;\n  startDate: string;\n  endDate: string;\n  totalSamples: number;\n  samplesWithGroundTruth: number;\n  overallDisparityScore: number;\n  demographicParityGap: number;\n  equalOpportunityGap: number;\n  calibrationGap: number;\n  parityAlert: boolean;\n  opportunityAlert: boolean;\n  calibrationAlert: boolean;\n  runAt: string;\n}\n\ninterface FairnessAlert {\n  type: string;\n  severity: string;\n  message: string;\n  gap: number;\n}\n\nexport default function FairnessCalibration() {\n  const [daysBack, setDaysBack] = useState(\"30\");\n  const { toast } = useToast();\n\n  const { data: alertsData, isLoading: alertsLoading } = useQuery<{\n    alerts: FairnessAlert[];\n    auditRun: AuditRun | null;\n  }>({\n    queryKey: [\"/api/fairness/alerts\"],\n  });\n\n  const { data: auditRuns, isLoading: auditRunsLoading } = useQuery<AuditRun[]>({\n    queryKey: [\"/api/fairness/audit-runs\"],\n  });\n\n  const latestAuditRun = auditRuns?.[0];\n\n  const { data: auditRunDetail, isLoading: detailLoading } = useQuery<{\n    auditRun: AuditRun;\n    metrics: FairnessMetric[];\n  }>({\n    queryKey: [\"/api/fairness/audit-runs\", latestAuditRun?.id],\n    enabled: !!latestAuditRun?.id,\n  });\n\n  const calculateMetricsMutation = useMutation({\n    mutationFn: async (days: number) => {\n      return await apiRequest(\"POST\", \"/api/fairness/calculate\", { daysBack: days });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/fairness/alerts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/fairness/audit-runs\"] });\n      toast({\n        title: \"Fairness metrics calculated\",\n        description: \"Bias detection metrics have been updated successfully.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Calculation failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCalculateMetrics = () => {\n    calculateMetricsMutation.mutate(parseInt(daysBack));\n  };\n\n  const metrics = auditRunDetail?.metrics || [];\n  const sortedMetrics = [...metrics].sort((a, b) => \n    a.fitzpatrickType.localeCompare(b.fitzpatrickType)\n  );\n\n  const hasAlerts = (alertsData?.alerts.length ?? 0) > 0;\n\n  return (\n    <div className=\"h-screen overflow-y-auto p-6 space-y-6\" data-testid=\"page-fairness-calibration\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold\" data-testid=\"text-page-title\">AI Fairness Calibration</h1>\n          <p className=\"text-muted-foreground mt-1\" data-testid=\"text-page-description\">\n            Monitor bias detection metrics across Fitzpatrick skin tones\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Select value={daysBack} onValueChange={setDaysBack}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-days-back\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"7\" data-testid=\"select-option-7days\">7 days</SelectItem>\n              <SelectItem value=\"30\" data-testid=\"select-option-30days\">30 days</SelectItem>\n              <SelectItem value=\"90\" data-testid=\"select-option-90days\">90 days</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button\n            onClick={handleCalculateMetrics}\n            disabled={calculateMetricsMutation.isPending}\n            data-testid=\"button-calculate-metrics\"\n          >\n            <Calculator className=\"w-4 h-4 mr-2\" />\n            {calculateMetricsMutation.isPending ? \"Calculating...\" : \"Calculate Metrics\"}\n          </Button>\n        </div>\n      </div>\n\n      {alertsLoading ? (\n        <Skeleton className=\"h-20 w-full\" />\n      ) : hasAlerts ? (\n        <Alert variant=\"destructive\" data-testid=\"alert-fairness-warnings\">\n          <AlertTriangle className=\"h-5 w-5\" />\n          <AlertDescription>\n            <div className=\"font-semibold mb-2\">Bias Alerts Detected</div>\n            <div className=\"space-y-1\">\n              {alertsData?.alerts.map((alert, idx) => (\n                <div key={idx} data-testid={`alert-item-${alert.type}`}>\n                  {alert.message}\n                </div>\n              ))}\n            </div>\n          </AlertDescription>\n        </Alert>\n      ) : latestAuditRun ? (\n        <Alert data-testid=\"alert-no-bias\">\n          <CheckCircle className=\"h-5 w-5 text-green-600\" />\n          <AlertDescription className=\"text-green-700\">\n            No significant bias detected. AI performance is well-calibrated across all skin tones.\n          </AlertDescription>\n        </Alert>\n      ) : null}\n\n      {auditRunsLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Skeleton key={i} className=\"h-32\" />\n          ))}\n        </div>\n      ) : latestAuditRun ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card data-testid=\"card-overall-disparity\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Overall Disparity</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-disparity-score\">\n                {(latestAuditRun.overallDisparityScore * 100).toFixed(1)}%\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Aggregate bias score\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-demographic-parity\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Demographic Parity Gap</CardTitle>\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-parity-gap\">\n                {(latestAuditRun.demographicParityGap * 100).toFixed(1)}%\n              </div>\n              <Badge\n                variant={latestAuditRun.parityAlert ? \"destructive\" : \"outline\"}\n                className=\"mt-1\"\n                data-testid=\"badge-parity-status\"\n              >\n                {latestAuditRun.parityAlert ? \"Alert\" : \"Normal\"}\n              </Badge>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-equal-opportunity\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Equal Opportunity Gap</CardTitle>\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-opportunity-gap\">\n                {(latestAuditRun.equalOpportunityGap * 100).toFixed(1)}%\n              </div>\n              <Badge\n                variant={latestAuditRun.opportunityAlert ? \"destructive\" : \"outline\"}\n                className=\"mt-1\"\n                data-testid=\"badge-opportunity-status\"\n              >\n                {latestAuditRun.opportunityAlert ? \"Alert\" : \"Normal\"}\n              </Badge>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-calibration\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Calibration Gap</CardTitle>\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-calibration-gap\">\n                {(latestAuditRun.calibrationGap * 100).toFixed(1)}%\n              </div>\n              <Badge\n                variant={latestAuditRun.calibrationAlert ? \"destructive\" : \"outline\"}\n                className=\"mt-1\"\n                data-testid=\"badge-calibration-status\"\n              >\n                {latestAuditRun.calibrationAlert ? \"Alert\" : \"Normal\"}\n              </Badge>\n            </CardContent>\n          </Card>\n        </div>\n      ) : (\n        <Card data-testid=\"card-no-data\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <Calculator className=\"w-12 h-12 mx-auto mb-3 text-muted-foreground\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No Fairness Audit Data Available</h3>\n              <p className=\"text-muted-foreground mb-4\">\n                Start monitoring AI bias by running your first fairness audit\n              </p>\n              <div className=\"bg-muted p-4 rounded-lg text-left max-w-md mx-auto mb-4\">\n                <h4 className=\"font-medium mb-2\">Before running an audit:</h4>\n                <ol className=\"text-sm text-muted-foreground space-y-1 list-decimal list-inside\">\n                  <li>Ensure you have analyzed lesion images</li>\n                  <li>Verify diagnoses on the Analysis History page</li>\n                  <li>Record ground truth labels for calibration</li>\n                  <li>Select a time window and click \"Calculate Metrics\"</li>\n                </ol>\n              </div>\n              <Button onClick={handleCalculateMetrics} disabled={calculateMetricsMutation.isPending}>\n                <Calculator className=\"w-4 h-4 mr-2\" />\n                Run First Audit\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {detailLoading ? (\n        <Skeleton className=\"h-96 w-full\" />\n      ) : sortedMetrics.length > 0 ? (\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card data-testid=\"card-positive-rate-chart\">\n            <CardHeader>\n              <CardTitle>Positive Prediction Rate by Skin Tone</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {sortedMetrics.map((metric) => (\n                  <div key={metric.fitzpatrickType} data-testid={`metric-row-${metric.fitzpatrickType}`}>\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <span className=\"text-sm font-medium\">\n                        Fitzpatrick {metric.fitzpatrickType}\n                      </span>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {(metric.positiveRate * 100).toFixed(1)}%\n                      </span>\n                    </div>\n                    <div className=\"h-2 bg-secondary rounded-full overflow-hidden\">\n                      <div\n                        className=\"h-full bg-primary\"\n                        style={{ width: `${metric.positiveRate * 100}%` }}\n                      />\n                    </div>\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      {metric.totalPredictions} samples\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-performance-metrics\">\n            <CardHeader>\n              <CardTitle>Performance Metrics by Skin Tone</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {sortedMetrics.map((metric) => (\n                  <div\n                    key={metric.fitzpatrickType}\n                    className=\"border-b pb-3 last:border-0\"\n                    data-testid={`performance-${metric.fitzpatrickType}`}\n                  >\n                    <div className=\"font-semibold mb-2\">\n                      Fitzpatrick {metric.fitzpatrickType}\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                      <div>\n                        <span className=\"text-muted-foreground\">Precision:</span>{\" \"}\n                        <span className=\"font-medium\">{(metric.precision * 100).toFixed(1)}%</span>\n                      </div>\n                      <div>\n                        <span className=\"text-muted-foreground\">Recall:</span>{\" \"}\n                        <span className=\"font-medium\">{(metric.recall * 100).toFixed(1)}%</span>\n                      </div>\n                      <div>\n                        <span className=\"text-muted-foreground\">F1 Score:</span>{\" \"}\n                        <span className=\"font-medium\">{(metric.f1Score * 100).toFixed(1)}%</span>\n                      </div>\n                      <div>\n                        <span className=\"text-muted-foreground\">Accuracy:</span>{\" \"}\n                        <span className=\"font-medium\">\n                          {(metric.accuracyAtConfidence * 100).toFixed(1)}%\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-confusion-matrix\">\n            <CardHeader>\n              <CardTitle>Confusion Matrix Statistics</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {sortedMetrics.map((metric) => (\n                  <div\n                    key={metric.fitzpatrickType}\n                    className=\"border-b pb-3 last:border-0\"\n                    data-testid={`confusion-${metric.fitzpatrickType}`}\n                  >\n                    <div className=\"font-semibold mb-2\">\n                      Fitzpatrick {metric.fitzpatrickType}\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div className=\"bg-green-50 dark:bg-green-950 p-2 rounded\">\n                        <div className=\"text-xs text-green-700 dark:text-green-300\">True Positives</div>\n                        <div className=\"text-lg font-bold text-green-900 dark:text-green-100\">\n                          {metric.truePositives}\n                        </div>\n                      </div>\n                      <div className=\"bg-red-50 dark:bg-red-950 p-2 rounded\">\n                        <div className=\"text-xs text-red-700 dark:text-red-300\">False Positives</div>\n                        <div className=\"text-lg font-bold text-red-900 dark:text-red-100\">\n                          {metric.falsePositives}\n                        </div>\n                      </div>\n                      <div className=\"bg-red-50 dark:bg-red-950 p-2 rounded\">\n                        <div className=\"text-xs text-red-700 dark:text-red-300\">False Negatives</div>\n                        <div className=\"text-lg font-bold text-red-900 dark:text-red-100\">\n                          {metric.falseNegatives}\n                        </div>\n                      </div>\n                      <div className=\"bg-green-50 dark:bg-green-950 p-2 rounded\">\n                        <div className=\"text-xs text-green-700 dark:text-green-300\">True Negatives</div>\n                        <div className=\"text-lg font-bold text-green-900 dark:text-green-100\">\n                          {metric.trueNegatives}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-calibration-metrics\">\n            <CardHeader>\n              <CardTitle>Calibration Metrics</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {sortedMetrics.map((metric) => (\n                  <div\n                    key={metric.fitzpatrickType}\n                    className=\"flex items-center justify-between\"\n                    data-testid={`calibration-metric-${metric.fitzpatrickType}`}\n                  >\n                    <div>\n                      <div className=\"font-medium\">Fitzpatrick {metric.fitzpatrickType}</div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        Avg Confidence: {metric.averageConfidence.toFixed(1)}%\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"font-semibold\">\n                        Brier Score: {metric.brierScore.toFixed(3)}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        Lower is better\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      ) : null}\n\n      {auditRuns && auditRuns.length > 0 && (\n        <Card data-testid=\"card-audit-history\">\n          <CardHeader>\n            <CardTitle>Recent Audit Runs</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {auditRuns.slice(0, 5).map((run) => (\n                <div\n                  key={run.id}\n                  className=\"flex items-center justify-between p-3 border rounded-lg hover-elevate\"\n                  data-testid={`audit-run-${run.id}`}\n                >\n                  <div>\n                    <div className=\"font-medium\">\n                      {new Date(run.runAt).toLocaleDateString()} at{\" \"}\n                      {new Date(run.runAt).toLocaleTimeString()}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {run.samplesWithGroundTruth} samples analyzed\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"text-sm font-semibold\">\n                      Disparity: {(run.overallDisparityScore * 100).toFixed(1)}%\n                    </div>\n                    <div className=\"flex gap-1 mt-1\">\n                      {run.parityAlert && (\n                        <Badge variant=\"destructive\" className=\"text-xs\">\n                          Parity\n                        </Badge>\n                      )}\n                      {run.opportunityAlert && (\n                        <Badge variant=\"destructive\" className=\"text-xs\">\n                          Opportunity\n                        </Badge>\n                      )}\n                      {run.calibrationAlert && (\n                        <Badge variant=\"destructive\" className=\"text-xs\">\n                          Calibration\n                        </Badge>\n                      )}\n                      {!run.parityAlert && !run.opportunityAlert && !run.calibrationAlert && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          No alerts\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":20345},"server/token-utils.ts":{"content":"import crypto from \"crypto\";\nimport bcrypt from \"bcrypt\";\n\nconst LOOKUP_SECRET = process.env.TOKEN_LOOKUP_SECRET || \"SAGAlyze-Token-Lookup-v1\";\n\n/**\n * Generates a secure random access token for patient portal access\n * Format: XXXX-XXXX-XXXX (12 characters + 2 hyphens = 14 total)\n * Uses cryptographically secure random bytes\n * Returns the plaintext token (show to clinician once, then hash before storing)\n */\nexport function generateAccessToken(): string {\n  const chars = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\"; // Avoid ambiguous characters (0,O,1,I)\n  const segments = 3;\n  const segmentLength = 4;\n  \n  const tokenSegments: string[] = [];\n  \n  for (let i = 0; i < segments; i++) {\n    let segment = \"\";\n    const randomBytes = crypto.randomBytes(segmentLength);\n    \n    for (let j = 0; j < segmentLength; j++) {\n      const randomIndex = randomBytes[j] % chars.length;\n      segment += chars[randomIndex];\n    }\n    \n    tokenSegments.push(segment);\n  }\n  \n  return tokenSegments.join(\"-\");\n}\n\n/**\n * Creates a deterministic lookup hash for efficient database queries\n * Uses HMAC-SHA256 with a secret key to prevent rainbow table attacks\n * This is used ONLY for lookup - the actual token is verified with bcrypt\n * \n * @param token - The plaintext access token\n * @returns A deterministic hex string for database lookup\n */\nexport function createTokenLookupHash(token: string): string {\n  return crypto.createHmac(\"sha256\", LOOKUP_SECRET).update(token).digest(\"hex\");\n}\n\n/**\n * Hashes an access token for secure storage using bcrypt\n * Uses adaptive hashing with per-token salting for maximum security\n * \n * @param token - The plaintext access token\n * @returns The bcrypt hash for storage (60-character string)\n */\nexport function hashAccessToken(token: string): string {\n  // Use bcrypt with 10 salt rounds (good balance of security and performance)\n  const saltRounds = 10;\n  return bcrypt.hashSync(token, saltRounds);\n}\n\n/**\n * Verifies a plaintext token against its stored bcrypt hash\n * Uses constant-time comparison to prevent timing attacks\n * \n * @param plainToken - The plaintext token provided by the user\n * @param hashedToken - The stored bcrypt hash from the database\n * @returns True if the tokens match\n */\nexport function verifyAccessToken(plainToken: string, hashedToken: string): boolean {\n  try {\n    return bcrypt.compareSync(plainToken, hashedToken);\n  } catch (error) {\n    // Invalid hash format or comparison error\n    return false;\n  }\n}\n\n/**\n * Validates access token format\n * Expected format: XXXX-XXXX-XXXX\n */\nexport function isValidTokenFormat(token: string): boolean {\n  const pattern = /^[A-Z2-9]{4}-[A-Z2-9]{4}-[A-Z2-9]{4}$/;\n  return pattern.test(token);\n}\n","size_bytes":2702}},"version":2}